<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Sakina Space</title>
<meta name="theme-color" content="#f5f0e8">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f5f0e8;--bg2:#ede8df;--bg3:#e6e0d5;
  --card:#ffffff;--card2:#f9f5ef;--card3:#f0ebe2;
  --border:#d8d0c4;--border2:#c8bfb0;
  --gold:#b8860b;--gold2:#9a6e00;--gold3:rgba(184,134,11,.1);--gold-light:#fdf3d7;
  --teal:#0e7a6e;--teal2:#0a9988;--teal3:rgba(14,122,110,.1);--teal-light:#e8f7f5;
  --rose:#c0435c;--rose2:#a83550;--rose-light:#fceef1;
  --purple:#6d3dcc;--purple2:#5a2eb5;--purple-light:#f0eaf9;
  --text:#1a1612;--text2:#3d3530;--muted:#7a7060;--muted2:#a09080;
  --green:#1a8a3e;--success-bg:#e8f7ee;
  --shadow:0 2px 12px rgba(0,0,0,.08);--shadow2:0 4px 24px rgba(0,0,0,.12);
  --safe-bottom:env(safe-area-inset-bottom,0px);
  --r:14px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{height:100%;height:-webkit-fill-available}
body{
  height:100%;height:100dvh;overflow:hidden;
  font-family:'Plus Jakarta Sans',sans-serif;
  background:var(--bg);color:var(--text);font-size:15px;
  touch-action:manipulation;
}
button,input{font-family:'Plus Jakarta Sans',sans-serif;cursor:pointer}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px}
svg.icon{display:inline-block;vertical-align:middle;flex-shrink:0}

/* â”€â”€ BACKGROUND â”€â”€ */
#bg-canvas{position:fixed;inset:0;z-index:0;pointer-events:none;background:linear-gradient(160deg,#fdf8f0 0%,#f0ebe0 50%,#e8e0d3 100%)}
.float-orb{position:absolute;border-radius:50%;filter:blur(60px);animation:orbFloat var(â€“d,8s) ease-in-out infinite alternate var(â€“dl,0s);opacity:.35}
@keyframes orbFloat{0%{transform:translate(0,0)}100%{transform:translate(var(â€“tx,20px),var(â€“ty,30px))}}
.particle{position:fixed;border-radius:50%;pointer-events:none;z-index:999;animation:floatUp var(â€“dur,1s) ease-out forwards}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(.3)}}

/* â”€â”€ APP â”€â”€ */
#app{position:relative;z-index:1;height:100dvh;display:flex;flex-direction:column}

/* â”€â”€ LOGIN â”€â”€ */
#login-screen{position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;background:rgba(245,240,232,.92);backdrop-filter:blur(8px);overflow-y:auto}
.lcard{background:var(â€“card);border:1px solid var(â€“border);border-radius:24px;padding:32px 28px;width:100%;max-width:400px;box-shadow:var(â€“shadow2);margin:auto}
.lcard-top{text-align:center;margin-bottom:28px}
.lcard-top .logo-icon{width:56px;height:56px;background:linear-gradient(135deg,var(â€“gold-light),#fff7e0);border:2px solid rgba(184,134,11,.3);border-radius:16px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-family:â€˜Amiriâ€™,serif;font-size:1.6rem;color:var(â€“gold)}
.lcard-top h1{font-size:1.6rem;font-weight:800;color:var(â€“text);letter-spacing:-.5px}
.lcard-top .ls{font-size:.75rem;color:var(â€“muted);margin-top:4px}
label.lbl{display:block;font-size:.7rem;font-weight:600;letter-spacing:.5px;color:var(â€“text2);margin-bottom:6px}
input.li{width:100%;background:var(â€“bg);border:1.5px solid var(â€“border);border-radius:10px;padding:13px 14px;color:var(â€“text);font-size:.95rem;outline:none;transition:border-color .2s,box-shadow .2s;margin-bottom:14px}
input.li:focus{border-color:var(â€“gold);box-shadow:0 0 0 3px rgba(184,134,11,.12)}
input.li::placeholder{color:var(â€“muted2)}
.hint{font-size:.72rem;color:var(â€“muted);margin-bottom:16px;line-height:1.6;padding:10px 12px;background:var(â€“gold3);border-radius:10px;border:1px solid rgba(184,134,11,.2)}
.hint strong{color:var(â€“gold2)}
.btn-gold{background:linear-gradient(135deg,#c8960d,#b8860b);border:none;border-radius:10px;padding:14px;color:#fff;font-weight:700;font-size:.82rem;letter-spacing:.5px;transition:opacity .2s,transform .1s;width:100%;margin-top:4px;display:block;box-shadow:0 2px 8px rgba(184,134,11,.3)}
.btn-gold:hover{opacity:.9;transform:translateY(-1px)}
.btn-gold:active{transform:translateY(0)}
.btn-teal{background:linear-gradient(135deg,#0f8c7e,#0a9988);border:none;border-radius:10px;padding:14px;color:#fff;font-weight:700;font-size:.82rem;transition:opacity .2s,transform .1s;width:100%;display:block;box-shadow:0 2px 8px rgba(14,122,110,.25)}
.btn-teal:hover{opacity:.9;transform:translateY(-1px)}
.btn-ghost{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:10px;padding:12px;color:var(â€“text2);font-size:.8rem;font-weight:600;transition:all .2s;width:100%;display:block}
.btn-ghost:hover{border-color:var(â€“gold);color:var(â€“gold2);background:var(â€“gold-light)}
.btn-sm{background:var(â€“card2);border:1.5px solid var(â€“border);border-radius:999px;padding:6px 14px;font-size:.72rem;font-weight:600;color:var(â€“text2);transition:all .2s}
.btn-sm:hover{border-color:var(â€“gold);color:var(â€“gold2);background:var(â€“gold-light)}
.btn-back{background:var(â€“card2);border:1.5px solid var(â€“border);border-radius:999px;padding:5px 12px;font-size:.7rem;font-weight:600;color:var(â€“muted);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px}
.btn-back:hover{border-color:var(â€“text2);color:var(â€“text2)}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;background:rgba(255,255,255,.85);border-bottom:1.5px solid var(â€“border);backdrop-filter:blur(12px);flex-shrink:0;gap:8px}
.tb-logo{font-size:1rem;font-weight:800;color:var(â€“text);letter-spacing:-.5px}
.tb-level{background:var(â€“gold-light);border:1.5px solid rgba(184,134,11,.3);border-radius:999px;padding:3px 10px;font-size:.62rem;font-weight:700;letter-spacing:.5px;color:var(â€“gold2)}
.tb-nour{display:flex;align-items:center;gap:5px;background:var(â€“gold-light);border:1.5px solid rgba(184,134,11,.3);border-radius:999px;padding:5px 12px;font-size:.74rem;font-weight:700;color:var(â€“gold2)}
.av{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;border:2px solid;flex-shrink:0}
.av.me{background:var(â€“gold-light);border-color:var(â€“gold);color:var(â€“gold2)}
.av.other{background:var(â€“teal3);border-color:var(â€“teal2);color:var(â€“teal);margin-left:-6px}
.online-badge{display:flex;align-items:center;gap:5px;background:var(â€“teal-light);border:1.5px solid rgba(14,122,110,.3);border-radius:999px;padding:4px 10px;font-size:.62rem;font-weight:700;color:var(â€“teal)}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(â€“teal);animation:blink 1.5s infinite;flex-shrink:0}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}

/* â”€â”€ LAYOUT â”€â”€ */
.main{flex:1;display:flex;overflow:hidden;min-height:0}
.sidebar{width:210px;flex-shrink:0;background:rgba(255,255,255,.7);border-right:1.5px solid var(â€“border);display:flex;flex-direction:column;overflow-y:auto;padding:8px 8px}
@media(max-width:640px){.sidebar{width:56px}.nlabel,.stitle{display:none}}
.stitle{font-size:.62rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(â€“muted2);padding:10px 8px 4px}
.ni{display:flex;align-items:center;gap:9px;padding:9px 10px;border-radius:10px;cursor:pointer;transition:all .18s;color:var(â€“muted);font-size:.83rem;font-weight:500;margin-bottom:2px;border:1.5px solid transparent}
.ni:hover{background:var(â€“bg2);color:var(â€“text2)}
.ni.active{background:var(â€“gold-light);border-color:rgba(184,134,11,.3);color:var(â€“gold2);font-weight:700}
.ni-icon{width:20px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.nbadge{margin-left:auto;background:var(â€“rose);border-radius:999px;font-size:.58rem;font-weight:700;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;padding:0 4px;color:#fff}
.content{flex:1;overflow:hidden;display:flex;flex-direction:column;min-height:0}
.panel{display:none;flex:1;flex-direction:column;overflow:hidden;min-height:0}
.panel.active{display:flex}
.scroll-area{flex:1;overflow-y:auto;padding:16px;-webkit-overflow-scrolling:touch}

/* â”€â”€ SHARED COMPONENTS â”€â”€ */
.card{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:var(â€“r);padding:16px;box-shadow:var(â€“shadow)}
.tag{display:inline-block;border-radius:999px;padding:3px 10px;font-size:.62rem;font-weight:700;letter-spacing:.3px}
.tag.gold{background:var(â€“gold-light);border:1.5px solid rgba(184,134,11,.3);color:var(â€“gold2)}
.tag.teal{background:var(â€“teal-light);border:1.5px solid rgba(14,122,110,.3);color:var(â€“teal)}
.tag.rose{background:var(â€“rose-light);border:1.5px solid rgba(192,67,92,.3);color:var(â€“rose)}
.tag.purple{background:var(â€“purple-light);border:1.5px solid rgba(109,61,204,.3);color:var(â€“purple2)}
.prog-bar{background:var(â€“bg3);border-radius:999px;height:6px;overflow:hidden}
.prog-fill{height:100%;border-radius:999px;transition:width .8s ease;position:relative;overflow:hidden}
.prog-fill::after{content:â€™â€™;position:absolute;top:0;left:-200%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.6),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{to{left:200%}}
.pb-gold{background:linear-gradient(90deg,#c8960d,#e8b020)}
.pb-teal{background:linear-gradient(90deg,var(â€“teal),var(â€“teal2))}
.pb-rose{background:linear-gradient(90deg,var(â€“rose),var(â€“rose2))}
.pb-purple{background:linear-gradient(90deg,var(â€“purple2),var(â€“purple))}
.section-title{font-size:.65rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(â€“muted);margin-bottom:10px}
.panel-title{font-size:1.3rem;font-weight:800;color:var(â€“text);margin-bottom:3px;letter-spacing:-.3px}
.panel-sub{font-size:.76rem;color:var(â€“muted);margin-bottom:14px}
.start-screen{text-align:center;padding:28px 16px}
.start-icon{display:flex;justify-content:center;margin-bottom:12px}
.start-title{font-size:1.3rem;font-weight:800;color:var(â€“text);margin-bottom:8px;letter-spacing:-.3px}
.start-desc{font-size:.78rem;color:var(â€“muted);margin-bottom:20px;line-height:1.7}

/* â”€â”€ HOME â”€â”€ */
.home-banner{background:linear-gradient(135deg,var(â€“gold-light),#fff8e6);border:1.5px solid rgba(184,134,11,.25);border-radius:18px;padding:22px;margin-bottom:14px;text-align:center;box-shadow:var(â€“shadow)}
.hb-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.4rem;color:var(â€“gold2);line-height:1.5}
.hb-en{font-size:1.4rem;font-weight:800;color:var(â€“text);margin-top:4px;letter-spacing:-.5px}
.hb-sub{font-size:.76rem;color:var(â€“muted);margin-top:4px}
.nour-wrap{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:var(â€“r);padding:14px;margin-bottom:14px;box-shadow:var(â€“shadow)}
.nour-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.nour-label{font-size:.65rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(â€“gold2)}
.nour-pts{font-size:1.5rem;font-weight:800;color:var(â€“text)}
.level-info{display:flex;justify-content:space-between;margin-top:4px;font-size:.63rem;font-weight:600;color:var(â€“muted)}
.games-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
@media(max-width:460px){.games-grid{grid-template-columns:1fr}}
.gc{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:var(â€“r);padding:16px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;box-shadow:var(â€“shadow)}
.gc:hover{transform:translateY(-2px);box-shadow:var(â€“shadow2);border-color:var(â€“gca,var(â€“gold))}
.gc-bg{position:absolute;top:-15px;right:-15px;width:60px;height:60px;border-radius:50%;background:var(â€“gcbg,var(â€“gold-light));opacity:.6}
.gc-icon{margin-bottom:7px;color:var(â€“gca,var(â€“gold2))}
.gc-title{font-weight:700;font-size:.85rem;margin-bottom:2px;color:var(â€“text)}
.gc-sub{font-size:.69rem;color:var(â€“muted)}
.gc-nour{position:absolute;bottom:10px;right:10px;font-size:.58rem;font-weight:700;padding:2px 8px;border-radius:999px;background:var(â€“gcbg,var(â€“gold-light));border:1.5px solid var(â€“gcbo,rgba(184,134,11,.3));color:var(â€“gca,var(â€“gold2))}
.ayah-box{background:var(â€“card);border-left:3px solid var(â€“gold);border-radius:var(â€“r);padding:16px;margin-bottom:14px;box-shadow:var(â€“shadow)}
.ayah-lbl{font-size:.62rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(â€“gold2);margin-bottom:8px}
.ayah-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.2rem;line-height:1.8;text-align:right;direction:rtl;color:var(â€“text);margin-bottom:6px}
.ayah-fr{font-size:.78rem;color:var(â€“muted);font-style:italic;line-height:1.6}
.ayah-ref{font-size:.64rem;color:var(â€“gold2);margin-top:5px;font-weight:600}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.stat-item{padding:4px 0}
.stat-lbl{font-size:.62rem;font-weight:700;color:var(â€“muted);letter-spacing:.5px;text-transform:uppercase;margin-bottom:3px}
.stat-val{font-size:1.3rem;font-weight:800;color:var(â€“text)}

/* â”€â”€ CHAT â”€â”€ */
.chat-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0}
.chat-msgs{flex:1;overflow-y:auto;padding:12px 14px;display:flex;flex-direction:column;gap:8px;-webkit-overflow-scrolling:touch;background:var(â€“bg2)}
.msg-sys{align-self:center;font-size:.68rem;font-weight:600;color:var(â€“muted);background:var(â€“card);border:1.5px solid var(â€“border);border-radius:999px;padding:4px 14px;box-shadow:var(â€“shadow)}
.msg-wrap{display:flex;gap:8px;max-width:84%;animation:msgIn .25s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.msg-wrap.mine{align-self:flex-end;flex-direction:row-reverse}
.m-av{width:30px;height:30px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.66rem;font-weight:700;margin-top:2px;border:2px solid}
.msg-wrap:not(.mine) .m-av{background:var(â€“teal-light);border-color:var(â€“teal);color:var(â€“teal)}
.msg-wrap.mine .m-av{background:var(â€“gold-light);border-color:var(â€“gold);color:var(â€“gold2)}
.m-name{font-size:.62rem;font-weight:600;color:var(â€“muted);margin-bottom:3px}
.msg-wrap.mine .m-name{text-align:right}
.m-bubble{padding:10px 14px;border-radius:14px;font-size:.86rem;line-height:1.55;word-break:break-word;box-shadow:var(â€“shadow)}
.msg-wrap:not(.mine) .m-bubble{background:var(â€“card);border:1.5px solid var(â€“border);border-top-left-radius:4px;color:var(â€“text)}
.msg-wrap.mine .m-bubble{background:linear-gradient(135deg,#c8960d,#b8860b);border:none;border-top-right-radius:4px;color:#fff}
.m-bubble a{color:inherit;text-decoration:underline;opacity:.9;word-break:break-all}
.msg-wrap.mine .m-bubble a{color:#fff}
.m-bubble.invite-bubble{background:var(â€“teal-light);border:1.5px solid rgba(14,122,110,.3);color:var(â€“text);box-shadow:var(â€“shadow)}
.invite-btn{background:linear-gradient(135deg,var(â€“teal),var(â€“teal2));border:none;border-radius:8px;padding:8px 14px;color:#fff;font-size:.74rem;font-weight:700;cursor:pointer;margin-top:8px;display:block;width:100%;transition:opacity .2s}
.invite-btn:hover{opacity:.85}
.invite-btn:disabled{opacity:.4;cursor:default}
.m-time{font-size:.6rem;color:var(â€“muted);margin-top:3px;font-weight:500}
.msg-wrap.mine .m-time{text-align:right}
.chat-quickbtns{display:flex;gap:6px;padding:8px 12px;flex-wrap:wrap;border-top:1.5px solid var(â€“border);background:var(â€“card2)}
.qb{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:999px;padding:5px 11px;font-size:.7rem;font-weight:600;color:var(â€“text2);cursor:pointer;transition:all .18s;display:flex;align-items:center;gap:4px;white-space:nowrap;box-shadow:var(â€“shadow)}
.qb:hover{border-color:var(â€“gold);color:var(â€“gold2);background:var(â€“gold-light)}
.chat-input-row{padding:8px 12px;padding-bottom:calc(10px + var(â€“safe-bottom));border-top:1.5px solid var(â€“border);display:flex;gap:8px;align-items:center;background:var(â€“card);flex-shrink:0}
.chat-input{flex:1;background:var(â€“bg);border:1.5px solid var(â€“border);border-radius:20px;padding:10px 14px;color:var(â€“text);font-size:.86rem;outline:none;transition:border-color .2s,box-shadow .2s}
.chat-input:focus{border-color:var(â€“gold);box-shadow:0 0 0 3px rgba(184,134,11,.1)}
.chat-input::placeholder{color:var(â€“muted2)}
.send-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#c8960d,#b8860b);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#fff;transition:opacity .2s,transform .1s;box-shadow:0 2px 8px rgba(184,134,11,.3)}
.send-btn:hover{opacity:.9;transform:scale(1.05)}
/* Media upload */
.media-btn{width:36px;height:36px;border-radius:50%;background:var(â€“bg);border:1.5px solid var(â€“border);cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:var(â€“muted);transition:all .2s}
.media-btn:hover{border-color:var(â€“teal);color:var(â€“teal);background:var(â€“teal-light)}
.m-bubble img.chat-img{max-width:220px;border-radius:10px;display:block;margin-top:6px;cursor:pointer}
.m-bubble video.chat-vid{max-width:220px;border-radius:10px;display:block;margin-top:6px}

/* â”€â”€ QUIZ â”€â”€ */
.quiz-header{flex-shrink:0;padding:10px 14px;border-bottom:1.5px solid var(â€“border);background:var(â€“card)}
.quiz-scoreline{display:flex;justify-content:space-between;align-items:center;gap:6px;margin-bottom:6px}
.qsc{flex:1;text-align:center}
.qsc-name{font-size:.62rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(â€“muted)}
.qsc-name.gold{color:var(â€“gold2)}
.qsc-val{font-size:1.8rem;font-weight:800;color:var(â€“text)}
.qsc-sep{color:var(â€“gold2);font-size:1.2rem;padding:0 4px;font-weight:300}
.qprogress{height:4px;background:var(â€“bg3)}
.qprogress-fill{height:100%;background:linear-gradient(90deg,var(â€“teal),var(â€“gold));transition:width .5s}
.quiz-body{flex:1;overflow-y:auto;padding:14px;background:var(â€“bg2)}
.q-card{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:var(â€“r);padding:16px;margin-bottom:10px;box-shadow:var(â€“shadow)}
.q-text{font-size:.95rem;font-weight:600;line-height:1.5;color:var(â€“text)}
.q-answers{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
@media(max-width:440px){.q-answers{grid-template-columns:1fr}}
.q-ans{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:10px;padding:11px 13px;cursor:pointer;font-size:.82rem;text-align:left;color:var(â€“text);display:flex;align-items:flex-start;gap:8px;transition:all .18s;width:100%;font-weight:500;box-shadow:var(â€“shadow)}
.q-ans:hover:not(:disabled){border-color:var(â€“gold);background:var(â€“gold-light)}
.q-ans.correct{background:var(â€“success-bg);border-color:var(â€“green);color:var(â€“green)}
.q-ans.wrong{background:var(â€“rose-light);border-color:var(â€“rose);color:var(â€“rose2)}
.q-ans.reveal{background:var(â€“success-bg);border-color:rgba(26,138,62,.4)}
.q-lbl{flex-shrink:0;width:20px;height:20px;border-radius:50%;background:var(â€“bg2);border:1.5px solid var(â€“border);color:var(â€“text2);font-size:.62rem;font-weight:700;display:flex;align-items:center;justify-content:center}
.q-expl{background:var(â€“teal-light);border-left:3px solid var(â€“teal);border-radius:10px;padding:10px 12px;font-size:.77rem;line-height:1.6;color:var(â€“teal);display:none;margin-top:6px}
.q-expl.show{display:block;animation:msgIn .3s ease}
.q-next{display:none;width:100%;background:linear-gradient(135deg,var(â€“teal),var(â€“teal2));border:none;border-radius:10px;padding:12px;color:#fff;font-weight:700;font-size:.78rem;letter-spacing:.3px;cursor:pointer;margin-top:8px;box-shadow:0 2px 8px rgba(14,122,110,.25)}
.q-next.show{display:block;animation:msgIn .3s ease}
.q-next:hover{opacity:.9}
.score-flash{animation:sf .4s ease}
@keyframes sf{0%{transform:scale(1.4);color:var(â€“gold2)}100%{transform:scale(1)}}
.wait-overlay{position:absolute;inset:0;background:rgba(245,240,232,.9);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;z-index:10}
.wait-spinner{width:36px;height:36px;border-radius:50%;border:3px solid var(â€“border2);border-top-color:var(â€“gold);animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ MULTI QUIZ TURN INDICATOR â”€â”€ */
.turn-bar{padding:8px 14px;text-align:center;font-size:.74rem;font-weight:700;border-bottom:1.5px solid var(â€“border);transition:background .3s}
.turn-bar.my-turn{background:var(â€“gold-light);color:var(â€“gold2)}
.turn-bar.their-turn{background:var(â€“teal-light);color:var(â€“teal)}

/* â”€â”€ SPRINT â”€â”€ */
.sprint-score-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px 14px;background:var(â€“card);border-radius:var(â€“r);border:1.5px solid var(â€“border);box-shadow:var(â€“shadow)}
.sprint-q{font-size:.95rem;font-weight:600;line-height:1.5;text-align:center;margin:10px 0;color:var(â€“text)}
.sprint-opts{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
@media(max-width:440px){.sprint-opts{grid-template-columns:1fr}}
.sprint-opt{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:10px;padding:11px 12px;cursor:pointer;font-size:.82rem;font-weight:500;color:var(â€“text);transition:all .18s;text-align:center;width:100%;box-shadow:var(â€“shadow)}
.sprint-opt:hover:not(:disabled){border-color:var(â€“rose);background:var(â€“rose-light)}
.sprint-opt.correct{background:var(â€“success-bg);border-color:var(â€“green);color:var(â€“green);pointer-events:none}
.sprint-opt.wrong{background:var(â€“rose-light);border-color:var(â€“rose);color:var(â€“rose2);pointer-events:none}
.timer-ring-wrap{position:relative;width:80px;height:80px;margin:0 auto 12px}

/* â”€â”€ MEMORY â”€â”€ */
.mem-stats{display:flex;gap:10px;justify-content:center;margin-bottom:12px}
.mem-stat{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:10px;padding:8px 16px;text-align:center;box-shadow:var(â€“shadow)}
.mem-stat-val{font-size:1.2rem;font-weight:800;color:var(â€“text)}
.mem-stat-lbl{font-size:.6rem;font-weight:600;color:var(â€“muted)}
.memory-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px}
@media(max-width:420px){.memory-grid{grid-template-columns:repeat(3,1fr);gap:6px}}
.mem-card{aspect-ratio:.85;border-radius:12px;cursor:pointer;border:1.5px solid var(â€“border);position:relative;overflow:hidden;transition:border-color .3s,box-shadow .3s;background:var(â€“card);box-shadow:var(â€“shadow)}
.mem-card.matched{border-color:var(â€“teal);box-shadow:0 0 14px rgba(14,122,110,.2);pointer-events:none}
.mem-face-back{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;background:var(â€“bg2);transition:opacity .25s}
.mem-face-front{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px;text-align:center;background:var(â€“card);opacity:0;transition:opacity .25s;pointer-events:none}
.mem-card.flipped .mem-face-back{opacity:0;pointer-events:none}
.mem-card.flipped .mem-face-front{opacity:1}
.mem-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.05rem;color:var(â€“text);line-height:1.3;margin-bottom:4px}
.mem-fr{font-size:.56rem;color:var(â€“muted);line-height:1.3;font-weight:500}
.mem-ph{font-size:.5rem;color:var(â€“gold2);font-style:italic;margin-top:2px;font-weight:600}
.mem-type{font-size:.5rem;letter-spacing:1px;text-transform:uppercase;color:var(â€“teal);margin-top:3px;font-weight:700}
.mem-card[data-type=â€œarâ€] .mem-face-front{background:var(â€“gold-light)}
.mem-card[data-type=â€œfrâ€] .mem-face-front{background:var(â€“teal-light)}

/* â”€â”€ WORD SEARCH â”€â”€ */
.ws-words{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:12px}
.ws-word{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:999px;padding:4px 12px;font-size:.72rem;font-weight:600;color:var(â€“text2);box-shadow:var(â€“shadow);transition:all .3s}
.ws-word.found{background:var(â€“teal-light);border-color:var(â€“teal);color:var(â€“teal);text-decoration:line-through;opacity:.7}
.ws-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:3px;margin-bottom:12px;user-select:none;-webkit-user-select:none}
.ws-cell{aspect-ratio:1;background:var(â€“card);border:1.5px solid var(â€“border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.68rem;font-weight:700;cursor:pointer;transition:all .15s;text-transform:uppercase;color:var(â€“text2)}
.ws-cell.selected{background:var(â€“gold-light);border-color:var(â€“gold);color:var(â€“gold2)}
.ws-cell.found-cell{background:var(â€“teal-light);border-color:var(â€“teal);color:var(â€“teal)}

/* â”€â”€ HADITHS â”€â”€ */
.h-card{background:var(â€“card);border-radius:var(â€“r);padding:16px;margin-bottom:10px;border:1.5px solid var(â€“border);cursor:pointer;transition:all .2s;position:relative;overflow:hidden;box-shadow:var(â€“shadow)}
.h-card:hover{border-color:rgba(184,134,11,.4);box-shadow:var(â€“shadow2)}
.h-card::before{content:â€™â€™;position:absolute;top:0;left:0;width:3px;height:100%;background:linear-gradient(180deg,var(â€“gold),var(â€“teal))}
.h-num{font-size:.62rem;font-weight:700;color:var(â€“muted);margin-bottom:8px}
.h-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.15rem;line-height:1.8;text-align:right;direction:rtl;margin-bottom:8px;color:var(â€“text)}
.h-fr{font-size:.8rem;color:var(â€“text2);font-style:italic;line-height:1.6}
.h-src{font-size:.64rem;color:var(â€“gold2);margin-top:6px;font-weight:700}
.h-reveal{display:none;margin-top:10px;padding-top:10px;border-top:1.5px solid var(â€“border)}
.h-card.open .h-reveal{display:block}
.h-vertu{font-size:.78rem;color:var(â€“muted);line-height:1.6}
.h-actions{display:flex;gap:6px;margin-top:10px}
.action-btn{background:var(â€“card2);border:1.5px solid var(â€“border);border-radius:999px;padding:5px 12px;font-size:.7rem;font-weight:600;color:var(â€“text2);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px}
.action-btn:hover{border-color:var(â€“gold);color:var(â€“gold2);background:var(â€“gold-light)}
.action-btn.liked{background:var(â€“rose-light);border-color:var(â€“rose);color:var(â€“rose2)}

/* â”€â”€ DUAS â”€â”€ */
.dua-cats{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
.dua-cat{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:999px;padding:6px 13px;font-size:.72rem;font-weight:600;cursor:pointer;transition:all .2s;color:var(â€“text2);box-shadow:var(â€“shadow)}
.dua-cat.active{background:var(â€“gold-light);border-color:rgba(184,134,11,.4);color:var(â€“gold2)}
.dua-card{background:var(â€“card);border-radius:var(â€“r);padding:16px;margin-bottom:10px;border:1.5px solid var(â€“border);box-shadow:var(â€“shadow)}
.dua-sit{font-size:.64rem;font-weight:700;letter-spacing:.3px;text-transform:uppercase;color:var(â€“teal);margin-bottom:8px}
.dua-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.2rem;line-height:1.8;text-align:right;direction:rtl;margin-bottom:8px;color:var(â€“text)}
.dua-ph{font-size:.76rem;color:var(â€“gold2);font-style:italic;margin-bottom:6px;line-height:1.5;font-weight:500}
.dua-fr{font-size:.78rem;color:var(â€“text2);line-height:1.6}
.dua-src{font-size:.64px;color:var(â€“muted);margin-top:5px;font-size:.64rem}

/* â”€â”€ DHIKR â”€â”€ */
.dhikr-select{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-bottom:14px}
.dhikr-opt{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:10px;padding:8px 12px;font-size:.74rem;font-weight:500;cursor:pointer;color:var(â€“text2);transition:all .2s;text-align:center;box-shadow:var(â€“shadow)}
.dhikr-opt.active{background:var(â€“gold-light);border-color:rgba(184,134,11,.4);color:var(â€“gold2);font-weight:700}
.dhikr-opt .do-ar{font-family:â€˜Amiriâ€™,serif;font-size:.95rem;display:block;color:var(â€“text)}
.dhikr-opt .do-fr{font-size:.6rem;margin-top:2px;color:var(â€“muted)}
.dhikr-display{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:20px;padding:22px;text-align:center;margin-bottom:12px;box-shadow:var(â€“shadow2)}
.dhikr-ar{font-family:â€˜Amiriâ€™,serif;font-size:1.8rem;color:var(â€“text);margin-bottom:4px}
.dhikr-ph-txt{font-size:.78rem;color:var(â€“gold2);font-style:italic;margin-bottom:2px;font-weight:600}
.dhikr-fr-txt{font-size:.74rem;color:var(â€“muted);margin-bottom:16px}
.dhikr-tap{width:110px;height:110px;border-radius:50%;margin:0 auto 14px;cursor:pointer;position:relative;-webkit-user-select:none;user-select:none;transition:transform .1s}
.dhikr-tap:active{transform:scale(.93)}
.dhikr-count-num{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2.4rem;font-weight:800;color:var(â€“text);z-index:1}
.dhikr-target-txt{font-size:.7rem;font-weight:600;color:var(â€“muted);margin-bottom:14px}
.dhikr-target-sel{display:flex;gap:8px;justify-content:center;margin-bottom:14px}
.dhikr-target-btn{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:999px;padding:5px 16px;font-size:.72rem;font-weight:700;color:var(â€“text2);cursor:pointer;transition:all .2s;box-shadow:var(â€“shadow)}
.dhikr-target-btn.active{background:var(â€“gold-light);border-color:var(â€“gold);color:var(â€“gold2)}
.dhikr-btn-row{display:flex;gap:8px;justify-content:center}

/* â”€â”€ LEADERBOARD â”€â”€ */
.lb-card{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:var(â€“r);padding:14px;margin-bottom:8px;display:flex;align-items:center;gap:12px;box-shadow:var(â€“shadow)}
.lb-card.me{border-color:rgba(184,134,11,.4);background:var(â€“gold-light)}
.lb-rank{font-size:1.4rem;font-weight:800;color:var(â€“muted);width:28px;text-align:center;flex-shrink:0}
.lb-av{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.84rem;flex-shrink:0;border:2px solid}
.lb-info{flex:1}
.lb-name{font-weight:700;font-size:.86rem;color:var(â€“text)}
.lb-pts{font-size:.7rem;color:var(â€“muted);font-weight:500}
.lb-nour{font-size:1.4rem;font-weight:800;color:var(â€“text)}
.lb-nour-lbl{font-size:.58rem;font-weight:600;color:var(â€“muted)}
.badges-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
@media(max-width:380px){.badges-grid{grid-template-columns:repeat(2,1fr)}}
.badge-card{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:12px;padding:12px;text-align:center;box-shadow:var(â€“shadow)}
.badge-card.unlocked{border-color:rgba(184,134,11,.4);background:var(â€“gold-light)}
.badge-card.locked{opacity:.35;filter:grayscale(.8)}
.bc-icon{margin-bottom:5px;display:flex;justify-content:center}
.bc-name{font-size:.7rem;font-weight:700;color:var(â€“text)}
.bc-req{font-size:.6rem;color:var(â€“muted);margin-top:2px}

/* â”€â”€ MODAL / TOAST â”€â”€ */
.modal-bg{position:fixed;inset:0;z-index:150;background:rgba(245,240,232,.7);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:16px}
.modal{background:var(â€“card);border:1.5px solid var(â€“border);border-radius:20px;padding:24px;width:100%;max-width:320px;text-align:center;animation:modalIn .3s ease;box-shadow:var(â€“shadow2)}
@keyframes modalIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.modal h2{font-size:1.3rem;font-weight:800;color:var(â€“text);margin-bottom:5px}
.modal p{font-size:.78rem;color:var(â€“muted);line-height:1.55;margin-bottom:16px}
.badge-icon-modal{display:flex;justify-content:center;margin-bottom:8px;animation:badgePop .55s cubic-bezier(.34,1.56,.64,1)}
@keyframes badgePop{from{transform:scale(0) rotate(-20deg)}to{transform:scale(1) rotate(0)}}
.modal-close{background:var(â€“card2);border:1.5px solid var(â€“border);color:var(â€“text2);border-radius:999px;padding:8px 22px;font-size:.74rem;font-weight:700;cursor:pointer;transition:all .2s}
.modal-close:hover{border-color:var(â€“gold);color:var(â€“gold2);background:var(â€“gold-light)}
.toast{position:fixed;bottom:calc(20px + var(â€“safe-bottom));left:50%;transform:translateX(-50%) translateY(60px);background:var(â€“text);border-radius:999px;font-size:.76rem;font-weight:600;z-index:300;transition:transform .3s ease;white-space:nowrap;pointer-events:none;padding:9px 20px;color:#fff;box-shadow:var(â€“shadow2)}
.toast.show{transform:translateX(-50%) translateY(0)}

/* â”€â”€ IMAGE LIGHTBOX â”€â”€ */
#lightbox{position:fixed;inset:0;z-index:400;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;cursor:pointer}
#lightbox img{max-width:92vw;max-height:92vh;border-radius:12px;object-fit:contain}
</style>

</head>
<body>

<div id="bg-canvas">
  <div class="float-orb" style="width:300px;height:300px;top:10%;left:5%;background:rgba(184,134,11,.15);--d:10s;--tx:30px;--ty:20px"></div>
  <div class="float-orb" style="width:250px;height:250px;top:40%;right:5%;background:rgba(14,122,110,.12);--d:12s;--dl:-4s;--tx:-25px;--ty:35px"></div>
  <div class="float-orb" style="width:200px;height:200px;bottom:10%;left:30%;background:rgba(109,61,204,.1);--d:9s;--dl:-2s;--tx:20px;--ty:-25px"></div>
</div>

<!-- LOGIN -->

<div id="login-screen">
  <div class="lcard">
    <div class="lcard-top">
      <div class="logo-icon">âœ¦</div>
      <h1>Sakina Space</h1>
      <div class="ls">Ton espace spirituel partagÃ©</div>
    </div>
    <label class="lbl">Ton prÃ©nom</label>
    <input class="li" id="ln" type="text" placeholder="Ex : Amina" maxlength="16" autocomplete="off">
    <label class="lbl">Code de l'espace</label>
    <input class="li" id="lcode" type="text" placeholder="Ex : FAMILLE Â· NOUR2025" maxlength="24"
      style="letter-spacing:1px;text-transform:uppercase"
      onkeydown="if(event.key==='Enter')goToRoom()">
    <div class="hint"><strong>Comment Ã§a marche</strong><br>Invente un code et partage-le. Tous ceux qui entrent le mÃªme code partagent le mÃªme espace.</div>
    <button class="btn-gold" onclick="goToRoom()">Entrer dans l'espace</button>
  </div>
</div>

<!-- APP -->

<div id="app" style="display:none">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:8px">
      <div class="tb-logo">âœ¦ Sakina</div>
      <div class="tb-level" id="tb-level">Mubtadi</div>
    </div>
    <div class="tb-nour">
      <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
      <span id="tb-nour">0</span> Nour
    </div>
    <div style="display:flex;align-items:center;gap:6px">
      <div id="av-wrap" style="display:flex"></div>
      <div class="online-badge"><div class="live-dot"></div><span id="online-count">1</span></div>
      <button class="btn-back" onclick="confirmBack()" title="Changer d'espace">
        <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
      </button>
    </div>
  </div>

  <div class="main">
    <div class="sidebar">
      <div class="stitle">Principal</div>
      <div class="ni active" id="nav-home" onclick="showPanel('home')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
        <span class="nlabel">Accueil</span>
      </div>
      <div class="ni" id="nav-chat" onclick="showPanel('chat')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></span>
        <span class="nlabel">Chat</span>
        <span class="nbadge" id="chat-badge" style="display:none">0</span>
      </div>
      <div class="stitle" style="margin-top:6px">Jeux</div>
      <div class="ni" id="nav-quiz" onclick="showPanel('quiz')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></span>
        <span class="nlabel">Quiz</span>
      </div>
      <div class="ni" id="nav-sprint" onclick="showPanel('sprint')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></span>
        <span class="nlabel">Sprint 30s</span>
      </div>
      <div class="ni" id="nav-memory" onclick="showPanel('memory')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></span>
        <span class="nlabel">Memory Dhikr</span>
      </div>
      <div class="ni" id="nav-wordsearch" onclick="showPanel('wordsearch')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span>
        <span class="nlabel">Mots mÃªlÃ©s</span>
      </div>
      <div class="stitle" style="margin-top:6px">Spirituel</div>
      <div class="ni" id="nav-hadith" onclick="showPanel('hadith')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></span>
        <span class="nlabel">Hadiths</span>
      </div>
      <div class="ni" id="nav-dua" onclick="showPanel('dua')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg></span>
        <span class="nlabel">Douaas</span>
      </div>
      <div class="ni" id="nav-dhikr" onclick="showPanel('dhikr')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg></span>
        <span class="nlabel">Dhikr</span>
      </div>
      <div class="stitle" style="margin-top:6px">Classement</div>
      <div class="ni" id="nav-leaderboard" onclick="showPanel('leaderboard')">
        <span class="ni-icon"><svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span>
        <span class="nlabel">Classement</span>
      </div>
    </div>

```
<div class="content">

  <!-- HOME -->
  <div class="panel active" id="panel-home">
    <div class="scroll-area">
      <div class="home-banner">
        <div class="hb-ar">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <div class="hb-en">Sakina Space</div>
        <div class="hb-sub" id="home-welcome">Bienvenue</div>
      </div>
      <div class="nour-wrap">
        <div class="nour-row">
          <div><div class="nour-label">Points de Nour</div><div id="level-name" style="font-size:.72rem;color:var(--muted);margin-top:2px;font-weight:500"></div></div>
          <div style="text-align:right"><div class="nour-pts" id="home-nour">0</div><div style="font-size:.6rem;color:var(--muted);font-weight:500">pts total</div></div>
        </div>
        <div class="prog-bar"><div class="prog-fill pb-gold" id="nour-bar-fill" style="width:0%"></div></div>
        <div class="level-info"><span id="level-from">0</span><span id="level-next-name" style="color:var(--gold2)"></span><span id="level-to">100</span></div>
      </div>
      <div class="section-title">Mini-jeux</div>
      <div class="games-grid">
        <div class="gc" style="--gca:var(--gold2);--gcbg:var(--gold-light);--gcbo:rgba(184,134,11,.3)" onclick="showPanel('quiz')"><div class="gc-bg"></div><div class="gc-icon"><svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div><div class="gc-title">Quiz Islam</div><div class="gc-sub">55 questions Â· multi</div><div class="gc-nour">+50 Nour</div></div>
        <div class="gc" style="--gca:var(--rose2);--gcbg:var(--rose-light);--gcbo:rgba(192,67,92,.3)" onclick="showPanel('sprint')"><div class="gc-bg"></div><div class="gc-icon"><svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div><div class="gc-title">Sprint 30s</div><div class="gc-sub">Max de rÃ©ponses</div><div class="gc-nour">+10/rÃ©p</div></div>
        <div class="gc" style="--gca:var(--teal);--gcbg:var(--teal-light);--gcbo:rgba(14,122,110,.3)" onclick="showPanel('memory')"><div class="gc-bg"></div><div class="gc-icon"><svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div><div class="gc-title">Memory Dhikr</div><div class="gc-sub">Dhikr en jouant</div><div class="gc-nour">+15/paire</div></div>
        <div class="gc" style="--gca:var(--purple2);--gcbg:var(--purple-light);--gcbo:rgba(109,61,204,.3)" onclick="showPanel('wordsearch')"><div class="gc-bg"></div><div class="gc-icon"><svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div><div class="gc-title">Mots mÃªlÃ©s</div><div class="gc-sub">Mots islamiques</div><div class="gc-nour">+35/mot</div></div>
      </div>
      <div class="ayah-box">
        <div class="ayah-lbl">Verset du jour</div>
        <div class="ayah-ar" id="aw-ar"></div>
        <div class="ayah-fr" id="aw-fr"></div>
        <div class="ayah-ref" id="aw-ref"></div>
      </div>
      <div class="section-title">Ma progression</div>
      <div class="card" style="margin-bottom:14px">
        <div class="stat-grid">
          <div class="stat-item"><div class="stat-lbl">Quiz</div><div class="stat-val" id="stat-quiz">0</div><div class="prog-bar" style="margin-top:3px"><div class="prog-fill pb-gold" id="pf-quiz" style="width:0%"></div></div></div>
          <div class="stat-item"><div class="stat-lbl">Hadiths</div><div class="stat-val" id="stat-hadith">0</div><div class="prog-bar" style="margin-top:3px"><div class="prog-fill pb-teal" id="pf-hadith" style="width:0%"></div></div></div>
          <div class="stat-item"><div class="stat-lbl">Dhikr total</div><div class="stat-val" id="stat-dhikr">0</div><div class="prog-bar" style="margin-top:3px"><div class="prog-fill pb-rose" id="pf-dhikr" style="width:0%"></div></div></div>
          <div class="stat-item"><div class="stat-lbl">Mots trouvÃ©s</div><div class="stat-val" id="stat-words">0</div><div class="prog-bar" style="margin-top:3px"><div class="prog-fill pb-purple" id="pf-words" style="width:0%"></div></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHAT -->
  <div class="panel" id="panel-chat">
    <div class="chat-wrap">
      <div class="chat-msgs" id="chat-msgs">
        <div class="msg-sys">Assalamu Alaykoum â€” Bienvenue dans Sakina Space</div>
      </div>
      <div class="chat-quickbtns">
        <button class="qb" onclick="quickSend('Assalamu alaykoum ğŸŒ™')">ğŸŒ™ Salam</button>
        <button class="qb" onclick="quickSend('Al Hamdoulilah âœ¨')">âœ¨ Al Hamdoulilah</button>
        <button class="qb" onclick="quickSend('Machallah ! ğŸ¤²')">ğŸ¤² Machallah</button>
        <button class="qb" onclick="sendGameInvite('quiz')">ğŸ¯ Inviter Quiz</button>
      </div>
      <div class="chat-input-row">
        <input type="file" id="media-input" accept="image/*,video/*" style="display:none" onchange="sendMedia(event)">
        <button class="media-btn" onclick="document.getElementById('media-input').click()" title="Photo / VidÃ©o">
          <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        </button>
        <input class="chat-input" id="chat-inp" placeholder="Ã‰cris un messageâ€¦" onkeydown="if(event.key==='Enter')sendChat()">
        <button class="send-btn" onclick="sendChat()">
          <svg class="icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="panel" id="panel-quiz" style="position:relative">
    <div id="quiz-turn-bar" class="turn-bar my-turn" style="display:none"></div>
    <div class="quiz-header" id="quiz-header" style="display:none">
      <div class="quiz-scoreline">
        <div class="qsc"><div class="qsc-name gold" id="qn1">Moi</div><div class="qsc-val" id="qs1">0</div></div>
        <div class="qsc-sep">âœ¦</div>
        <div class="qsc"><div class="qsc-name" id="qn2">Solo</div><div class="qsc-val" id="qs2">â€”</div></div>
      </div>
      <div class="qprogress"><div class="qprogress-fill" id="qpf" style="width:0%"></div></div>
    </div>
    <div class="quiz-body" id="quiz-body">
      <div class="start-screen">
        <div class="start-icon"><svg class="icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div>
        <div class="start-title">Quiz Islam</div>
        <div class="start-desc">20 questions Â· Bonne rÃ©ponse = <strong>+50 Nour</strong><br><span style="color:var(--teal);font-weight:600">En multijoueur : chacun rÃ©pond Ã  son tour â€” le premier Ã  10 bonnes rÃ©ponses gagne !</span></div>
        <button class="btn-gold" style="max-width:220px;margin:0 auto 10px" onclick="startQuiz(false)">Jouer en solo</button>
        <button class="btn-teal" style="max-width:220px;margin:0 auto" onclick="sendGameInvite('quiz');showPanel('chat')">Inviter quelqu'un</button>
      </div>
    </div>
  </div>

  <!-- SPRINT -->
  <div class="panel" id="panel-sprint">
    <div class="scroll-area" id="sprint-wrap">
      <div class="start-screen">
        <div class="start-icon"><svg class="icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--rose2)" stroke-width="1.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
        <div class="start-title">Sprint 30 secondes</div>
        <div class="start-desc">Max de bonnes rÃ©ponses en 30s.<br><strong>+10 Nour</strong> par bonne rÃ©ponse</div>
        <button class="btn-ghost" style="max-width:200px;margin:0 auto" onclick="startSprint()">Lancer</button>
      </div>
    </div>
  </div>

  <!-- MEMORY -->
  <div class="panel" id="panel-memory">
    <div class="scroll-area" id="memory-wrap">
      <div class="start-screen">
        <div class="start-icon"><svg class="icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="1.5"><rect x="2" y="3" width="20" height="14" rx="2"/></svg></div>
        <div class="start-title">Memory Dhikr</div>
        <div class="start-desc">Associe le dhikr arabe â†” sa traduction.<br><strong>+15 Nour</strong> par paire</div>
        <button class="btn-teal" style="max-width:200px;margin:0 auto" onclick="startMemory()">Commencer</button>
      </div>
    </div>
  </div>

  <!-- WORD SEARCH -->
  <div class="panel" id="panel-wordsearch">
    <div class="scroll-area" id="ws-wrap">
      <div class="start-screen">
        <div class="start-icon"><svg class="icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--purple2)" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
        <div class="start-title">Mots mÃªlÃ©s</div>
        <div class="start-desc">Retrouve les mots islamiques.<br><strong>+35 Nour</strong> par mot</div>
        <button class="btn-ghost" style="max-width:200px;margin:0 auto;border-color:var(--purple);color:var(--purple2)" onclick="startWS()">Lancer</button>
      </div>
    </div>
  </div>

  <!-- HADITH -->
  <div class="panel" id="panel-hadith"><div class="scroll-area"><div class="panel-title">Hadiths</div><div class="panel-sub">Clique pour dÃ©velopper Â· +5 Nour par hadith lu</div><div id="hadith-list"></div></div></div>

  <!-- DUA -->
  <div class="panel" id="panel-dua"><div class="scroll-area"><div class="panel-title">Douaas</div><div class="panel-sub">Invocations essentielles</div><div class="dua-cats" id="dua-cats"></div><div id="dua-list"></div></div></div>

  <!-- DHIKR -->
  <div class="panel" id="panel-dhikr">
    <div class="scroll-area">
      <div class="panel-title">Dhikr</div>
      <div style="margin-bottom:14px"></div>
      <div class="dhikr-select" id="dhikr-select"></div>
      <div class="dhikr-display">
        <div class="dhikr-ar" id="dhikr-ar">Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù</div>
        <div class="dhikr-ph-txt" id="dhikr-ph-txt">Subhanallah</div>
        <div class="dhikr-fr-txt" id="dhikr-fr-txt">Gloire Ã  Allah</div>
        <div class="dhikr-tap" id="dhikr-tap" onclick="tapDhikr()">
          <svg style="position:absolute;inset:0;width:100%;height:100%;transform:rotate(-90deg)" viewBox="0 0 110 110">
            <circle cx="55" cy="55" r="48" fill="none" stroke="var(--bg3)" stroke-width="8"/>
            <circle id="dhikr-ring" cx="55" cy="55" r="48" fill="none" stroke="var(--gold)" stroke-width="8" stroke-linecap="round" stroke-dasharray="301.6" stroke-dashoffset="301.6" style="transition:stroke-dashoffset .3s ease"/>
          </svg>
          <div style="position:absolute;inset:8px;border-radius:50%;background:var(--bg2);border:1.5px solid var(--border)"></div>
          <div class="dhikr-count-num" id="dhikr-count">0</div>
        </div>
        <div class="dhikr-target-sel" id="dhikr-target-sel">
          <button class="dhikr-target-btn active" onclick="setTarget(33,this)">33Ã—</button>
          <button class="dhikr-target-btn" onclick="setTarget(99,this)">99Ã—</button>
          <button class="dhikr-target-btn" onclick="setTarget(100,this)">100Ã—</button>
        </div>
        <div class="dhikr-target-txt" id="dhikr-target">0 / 33</div>
        <div class="dhikr-btn-row">
          <button class="btn-sm" onclick="undoDhikr()">Annuler</button>
          <button class="btn-sm" onclick="resetDhikr()" style="color:var(--rose2);border-color:rgba(192,67,92,.4)">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD -->
  <div class="panel" id="panel-leaderboard">
    <div class="scroll-area">
      <div class="panel-title">Classement</div>
      <div class="panel-sub" id="lb-code-sub">Espace</div>
      <div id="lb-list"></div>
      <div style="margin-top:16px"><div class="section-title">Badges spirituels</div><div class="badges-grid" id="badges-grid"></div></div>
    </div>
  </div>
</div>
```

  </div>
</div>

<!-- BADGE MODAL -->

<div class="modal-bg" id="badge-modal" style="display:none" onclick="closeModal('badge-modal')">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="badge-icon-modal" id="bm-icon"></div>
    <h2 id="bm-name">Badge dÃ©bloquÃ© !</h2>
    <p id="bm-desc"></p>
    <button class="modal-close" onclick="closeModal('badge-modal')">Continuer</button>
  </div>
</div>

<!-- IMAGE LIGHTBOX -->

<div id="lightbox" onclick="this.style.display='none'"><img id="lb-img" src="" alt=""></div>

<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>

<script>
/* â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â• */
const LEVELS=[
  {name:'Mubtadi',min:0},{name:'Taalib',min:100},{name:'Moujtahid',min:300},
  {name:'Hafidh',min:600},{name:'Aalim',min:1000},{name:'Zaahid',min:1500},{name:'Wali',min:2200}
];
const BADGES=[
  {id:'first_quiz',name:'Premier Quiz',req:'Terminer ton premier quiz',svgKey:'quiz',cond:s=>s.quizDone>=1},
  {id:'quiz5',name:'Assidu',req:'5 quiz terminÃ©s',svgKey:'quiz',cond:s=>s.quizDone>=5},
  {id:'sprint_ace',name:'Sprint Ace',req:'Score Sprint â‰¥ 8',svgKey:'sprint',cond:s=>s.sprintBest>=8},
  {id:'memory_done',name:'MÃ©moire de fer',req:'ComplÃ©ter le Memory Dhikr',svgKey:'mem',cond:s=>s.memoryDone>=1},
  {id:'word5',name:'Chasseur de mots',req:'5 mots trouvÃ©s',svgKey:'search',cond:s=>s.wordsFound>=5},
  {id:'hadith5',name:'Explorateur',req:'5 hadiths lus',svgKey:'book',cond:s=>s.hadithRead>=5},
  {id:'dhikr100',name:'100 Dhikr',req:'100 dhikr accomplis',svgKey:'circle',cond:s=>s.dhikrTotal>=100},
  {id:'nour500',name:'Ã‰toile montante',req:'500 Nour',svgKey:'star',cond:s=>s.nour>=500},
  {id:'nour2k',name:'LumiÃ¨re divine',req:'2000 Nour',svgKey:'star',cond:s=>s.nour>=2000},
];
const BSVG={
  quiz:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
  sprint:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--rose2)" stroke-width="1.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
  mem:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="1.5"><rect x="2" y="3" width="20" height="14" rx="2"/></svg>`,
  search:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--purple2)" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>`,
  book:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.5"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
  circle:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>`,
  star:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--gold2)" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,
};
const QUIZ_DATA=[
  {q:"Combien de piliers a l'Islam ?",a:["3","4","5","6"],c:2,cat:"Piliers",expl:"Les 5 piliers : Chahada, Salat, Zakat, Sawm, Hajj."},
  {q:"Quel est le 9Ã¨me mois du calendrier islamique ?",a:["Rajab","Chawwal","Dhul-Hijja","Ramadan"],c:3,cat:"Ramadan",expl:"Ramadan est le 9Ã¨me mois hÃ©girien."},
  {q:"Quelle est la premiÃ¨re sourate du Coran ?",a:["Al-Baqara","Yassine","Al-Fatiha","An-Nas"],c:2,cat:"Coran",expl:"Al-Fatiha (L'Ouverture) compte 7 versets."},
  {q:"Combien de sourates contient le Coran ?",a:["99","100","114","120"],c:2,cat:"Coran",expl:"Le Coran contient 114 sourates."},
  {q:"Quel ange a transmis le Coran ?",a:["Mikail","Israfil","Azrael","Djibril"],c:3,cat:"Coran",expl:"Djibril (Gabriel) a rÃ©vÃ©lÃ© le Coran sur 23 ans."},
  {q:"Quel prophÃ¨te a construit une arche ?",a:["Ibrahim","Musa","Nouh","Dawud"],c:2,cat:"ProphÃ¨tes",expl:"Nouh (NoÃ©) construisit l'arche pour le dÃ©luge."},
  {q:"Dans quelle ville est nÃ© le ProphÃ¨te ï·º ?",a:["MÃ©dine","La Mecque","TaÃ¯f","JÃ©rusalem"],c:1,cat:"Histoire",expl:"NÃ© Ã  La Mecque vers 570 apr. J.-C."},
  {q:"En quelle annÃ©e a eu lieu l'HÃ©gire ?",a:["610","622","632","640"],c:1,cat:"Histoire",expl:"En 622, migration de La Mecque vers MÃ©dine."},
  {q:"Comment s'appelle la rupture du jeÃ»ne ?",a:["Suhur","Tarawih","Iftar","Qiyam"],c:2,cat:"Ramadan",expl:"L'Iftar se fait au coucher du soleil."},
  {q:"Quel prophÃ¨te a reÃ§u la Torah ?",a:["Ibrahim","Dawud","Musa","Issa"],c:2,cat:"ProphÃ¨tes",expl:"Musa (MoÃ¯se) a reÃ§u la Torah sur le mont SinaÃ¯."},
  {q:"Quelle nuit vaut mieux que mille mois ?",a:["Nuit de l'HÃ©gire","Laylat al-Qadr","Nuit de l'AÃ¯d","Nuit de Badr"],c:1,cat:"Ramadan",expl:"Laylat al-Qadr est dans les 10 derniers jours."},
  {q:"Que signifie 'Inshallah' ?",a:["Merci Ã  Dieu","Si Dieu le veut","Gloire Ã  Dieu","Dieu est grand"],c:1,cat:"Vocabulaire",expl:"Inshallah = Si Allah le veut."},
  {q:"Quel prophÃ¨te est nÃ© sans pÃ¨re ?",a:["Yahya","Yunus","Issa","Idris"],c:2,cat:"ProphÃ¨tes",expl:"Issa (JÃ©sus) est nÃ© de la Vierge Maryam."},
  {q:"Combien de fois par jour le croyant prie-t-il ?",a:["3","4","5","7"],c:2,cat:"Piliers",expl:"5 priÃ¨res : Fajr, Dhuhr, Asr, Maghrib, Isha."},
  {q:"Quel est le taux de la Zakat ?",a:["1%","2,5%","5%","10%"],c:1,cat:"Piliers",expl:"La Zakat est de 2,5% des Ã©conomies."},
  {q:"Quelle sourate est surnommÃ©e cÅ“ur du Coran ?",a:["Al-Fatiha","Al-Baqara","Yassine","Al-Kahf"],c:2,cat:"Coran",expl:"La sourate Yassine (36) est le cÅ“ur du Coran."},
  {q:"Avec quoi rompt-on traditionnellement le jeÃ»ne ?",a:["Du pain","De la soupe","Des dattes","Du lait"],c:2,cat:"Ramadan",expl:"Le ProphÃ¨te ï·º rompait le jeÃ»ne avec des dattes."},
  {q:"Comment s'appelle le repas avant l'aube ?",a:["Iftar","Suhur","Tarawih","Witr"],c:1,cat:"Ramadan",expl:"Le Suhur est bÃ©ni, ne le manque pas !"},
  {q:"Combien de juz' compte le Coran ?",a:["10","20","30","40"],c:2,cat:"Coran",expl:"30 juz' â€” un par jour pendant le Ramadan."},
  {q:"Comment s'appelle la priÃ¨re nocturne du Ramadan ?",a:["Tahajjud","Duha","Tarawih","Witr"],c:2,cat:"Ramadan",expl:"La Tarawih est accomplie en groupe aprÃ¨s Isha."},
  {q:"Que signifie 'Subhanallah' ?",a:["Dieu est grand","Gloire Ã  Dieu","Louange Ã  Dieu","Il n'y a de dieu qu'Allah"],c:1,cat:"Vocabulaire",expl:"Subhanallah = Gloire Ã  Allah."},
  {q:"Que signifie 'Alhamdulillah' ?",a:["Gloire Ã  Dieu","Si Dieu le veut","Louange Ã  Dieu","Dieu est grand"],c:2,cat:"Vocabulaire",expl:"Alhamdulillah = Toute louange est due Ã  Allah."},
  {q:"Que signifie 'Allahu Akbar' ?",a:["Gloire Ã  Dieu","Allah est le Plus Grand","Il n'y a de dieu qu'Allah","Louange Ã  Dieu"],c:1,cat:"Vocabulaire",expl:"Allahu Akbar = Allah est le Plus Grand."},
  {q:"Combien de prophÃ¨tes sont mentionnÃ©s dans le Coran ?",a:["15","20","25","30"],c:2,cat:"ProphÃ¨tes",expl:"25 prophÃ¨tes sont nommÃ©s dans le Coran."},
  {q:"Quel est le premier pilier de l'Islam ?",a:["La priÃ¨re","Le jeÃ»ne","La Chahada","Le pÃ¨lerinage"],c:2,cat:"Piliers",expl:"La Chahada : 'Il n'y a de dieu qu'Allah...'"},
  {q:"Vers quelle direction les musulmans se tournent pour prier ?",a:["MÃ©dine","JÃ©rusalem","La Mecque","Le Caire"],c:2,cat:"Piliers",expl:"La Qibla pointe vers la Kaaba Ã  La Mecque."},
  {q:"Comment s'appelle le pÃ¨lerinage Ã  La Mecque ?",a:["Zakat","Umra","Hajj","Sawm"],c:2,cat:"Piliers",expl:"Le Hajj est le 5Ã¨me pilier."},
  {q:"Quel est le livre sacrÃ© des musulmans ?",a:["La Bible","La Torah","Le Coran","Les Psaumes"],c:2,cat:"Coran",expl:"Le Coran a Ã©tÃ© rÃ©vÃ©lÃ© au ProphÃ¨te Muhammad ï·º."},
  {q:"Comment s'appelle la mosquÃ©e la plus sacrÃ©e de l'Islam ?",a:["Masjid al-Aqsa","Masjid an-Nabawi","Masjid al-Haram","Masjid Quba"],c:2,cat:"Histoire",expl:"Masjid al-Haram Ã  La Mecque est la plus sacrÃ©e."},
  {q:"Quel est le mois du pÃ¨lerinage ?",a:["Ramadan","Rajab","Dhul-Hijja","Muharram"],c:2,cat:"Histoire",expl:"Le Hajj se dÃ©roule pendant le mois de Dhul-Hijja."},
  {q:"Quel prophÃ¨te est considÃ©rÃ© comme le pÃ¨re des prophÃ¨tes ?",a:["Adam","Nouh","Ibrahim","Muhammad"],c:2,cat:"ProphÃ¨tes",expl:"Ibrahim (Abraham) est appelÃ© le Khalil (ami d'Allah)."},
  {q:"Quel est le nom arabe de JÃ©sus ?",a:["Issa","Yahya","Musa","Ibrahim"],c:0,cat:"ProphÃ¨tes",expl:"Issa (JÃ©sus) est un prophÃ¨te de l'Islam."},
  {q:"Quel prophÃ¨te a survÃ©cu dans le ventre d'une baleine ?",a:["Dawud","Yunus","Musa","Ismail"],c:1,cat:"ProphÃ¨tes",expl:"Yunus (Jonas) a passÃ© du temps dans le ventre d'une baleine."},
  {q:"Quelle est la plus grande sourate du Coran ?",a:["Al-Fatiha","Al-Imran","Al-Baqara","An-Nisa"],c:2,cat:"Coran",expl:"Al-Baqara contient 286 versets, la plus longue sourate."},
  {q:"Combien de versets contient Al-Fatiha ?",a:["5","6","7","8"],c:2,cat:"Coran",expl:"Al-Fatiha compte 7 versets, rÃ©citÃ©s dans chaque rakaat."},
  {q:"Comment s'appelle l'ablution en islam ?",a:["Tayammum","Wudu","Ghusl","Istainja"],c:1,cat:"Piliers",expl:"Le Wudu est l'ablution mineure avant la priÃ¨re."},
  {q:"Quel est le premier mois du calendrier islamique ?",a:["Ramadan","Dhul-Hijja","Muharram","Rajab"],c:2,cat:"Histoire",expl:"Muharram est le premier mois de l'annÃ©e hÃ©girienne."},
  {q:"Que signifie 'Islam' en arabe ?",a:["Paix","Soumission","Foi","Justice"],c:1,cat:"Vocabulaire",expl:"Islam signifie soumission Ã  la volontÃ© d'Allah."},
  {q:"Combien de rakaat contient la priÃ¨re Fajr ?",a:["2","3","4","5"],c:0,cat:"Piliers",expl:"Fajr = 2 rakaat obligatoires (+ 2 sunnah)."},
  {q:"Combien de rakaat contient la priÃ¨re Maghrib ?",a:["2","3","4","5"],c:1,cat:"Piliers",expl:"Maghrib = 3 rakaat obligatoires."},
  {q:"Comment s'appelle le prophÃ¨te qui a pu parler aux animaux ?",a:["Dawud","Nouh","Sulayman","Ibrahim"],c:2,cat:"ProphÃ¨tes",expl:"Sulayman (Salomon) pouvait parler aux oiseaux."},
  {q:"Quel est le nom arabe de Marie, mÃ¨re de JÃ©sus ?",a:["Fatima","Khadija","Maryam","Asiya"],c:2,cat:"Coran",expl:"Maryam est la seule femme nommÃ©e dans le Coran."},
  {q:"Quel prophÃ¨te a Ã©tÃ© jetÃ© dans le feu et n'a pas brÃ»lÃ© ?",a:["Musa","Issa","Ibrahim","Yunus"],c:2,cat:"ProphÃ¨tes",expl:"Allah dit 'Ã” feu, sois fraÃ®cheur et paix pour Ibrahim'."},
  {q:"Que signifie 'Astaghfirullah' ?",a:["Dieu merci","Je demande pardon Ã  Dieu","Gloire Ã  Dieu","Que Dieu te bÃ©nisse"],c:1,cat:"Vocabulaire",expl:"Astaghfirullah = Je demande pardon Ã  Allah."},
  {q:"Quel jour est considÃ©rÃ© comme le plus sacrÃ© de la semaine ?",a:["Samedi","Dimanche","Lundi","Vendredi"],c:3,cat:"Piliers",expl:"Le vendredi (Yawm al-Jum'a) est le maÃ®tre des jours."},
  {q:"Quel est le nombre de Noms d'Allah mentionnÃ©s dans le hadith des 99 noms ?",a:["33","66","99","100"],c:2,cat:"Vocabulaire",expl:"Allah a 99 Noms â€” celui qui les dÃ©nombre entre au Paradis."},
  {q:"Combien de fois les pÃ¨lerins tournent autour de la Kaaba ?",a:["3","5","7","9"],c:2,cat:"Histoire",expl:"Le Tawaf consiste en 7 circumambulations autour de la Kaaba."},
  {q:"Quel prophÃ¨te a fendu la mer ?",a:["Ibrahim","Sulayman","Musa","Issa"],c:2,cat:"ProphÃ¨tes",expl:"Musa a fendu la mer avec sa canne par la permission d'Allah."},
  {q:"Que signifie 'Barakallah fik' ?",a:["Que Dieu te pardonne","Que Dieu te bÃ©nisse","Dieu est grand","Gloire Ã  Dieu"],c:1,cat:"Vocabulaire",expl:"Barakallah fik = Que la bÃ©nÃ©diction d'Allah soit sur toi."},
  {q:"Dans quelle sourate trouve-t-on le Verset du TrÃ´ne ?",a:["Al-Fatiha","Al-Baqara","Al-Imran","Yassine"],c:1,cat:"Coran",expl:"Ayat al-Kursi est le verset 255 de Al-Baqara."},
];
const DHIKR_MEMORY=[
  {ar:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù",ph:"Subhanallah",fr:"Gloire Ã  Allah"},
  {ar:"Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù",ph:"Alhamdulillah",fr:"Louange Ã  Allah"},
  {ar:"Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",ph:"Allahu Akbar",fr:"Allah est le Plus Grand"},
  {ar:"Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù",ph:"La ilaha illallah",fr:"Il n'y a de dieu qu'Allah"},
  {ar:"Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡Ù",ph:"Astaghfirullah",fr:"Je demande pardon Ã  Allah"},
  {ar:"Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù",ph:"Bismillah",fr:"Au nom d'Allah"},
  {ar:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù",ph:"Subhanallah wabihamdih",fr:"Gloire Ã  Allah et Sa louange"},
  {ar:"Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„Ù‡Ù",ph:"La hawla wala quwwata illa billah",fr:"Pas de force sauf par Allah"},
];
const DHIKR_LIST=[
  {ar:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù",ph:"Subhanallah",fr:"Gloire Ã  Allah",target:33},
  {ar:"Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù",ph:"Alhamdulillah",fr:"Louange Ã  Allah",target:33},
  {ar:"Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",ph:"Allahu Akbar",fr:"Allah est le Plus Grand",target:33},
  {ar:"Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù",ph:"La ilaha illallah",fr:"Il n'y a de dieu qu'Allah",target:100},
  {ar:"Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡Ù",ph:"Astaghfirullah",fr:"Je demande pardon Ã  Allah",target:100},
];
const HADITHS=[
  {num:1,ar:"Ù…ÙÙ†Ù’ ØµÙØ§Ù…Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø¥ÙÙŠÙ…ÙØ§Ù†Ù‹Ø§ ÙˆÙØ§Ø­Ù’ØªÙØ³ÙØ§Ø¨Ù‹Ø§",fr:"Quiconque jeÃ»ne le Ramadan par foi et espÃ©rant la rÃ©compense, ses pÃ©chÃ©s passÃ©s lui seront pardonnÃ©s.",src:"Bukhari & Muslim",vertu:"Une des plus grandes promesses divines. Le jeÃ»ne sincÃ¨re efface les pÃ©chÃ©s passÃ©s.",cat:"Ramadan"},
  {num:2,ar:"Ø¥ÙØ°ÙØ§ Ø¬ÙØ§Ø¡Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù ÙÙØªÙØ­ÙØªÙ’ Ø£ÙØ¨Ù’ÙˆÙØ§Ø¨Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù",fr:"Lorsque vient le Ramadan, les portes du Paradis s'ouvrent et celles de l'Enfer se ferment.",src:"Bukhari & Muslim",vertu:"Ce mois est unique. Toutes les conditions sont rÃ©unies pour l'Ã©lÃ©vation spirituelle.",cat:"Ramadan"},
  {num:3,ar:"Ø§Ù„ØµÙÙ‘ÙˆÙ’Ù…Ù Ø¬ÙÙ†ÙÙ‘Ø©ÙŒ",fr:"Le jeÃ»ne est un bouclier.",src:"Bukhari",vertu:"Un seul mot, une immense sagesse. Le jeÃ»ne protÃ¨ge l'Ã¢me.",cat:"Ramadan"},
  {num:4,ar:"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø§Ù„Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¨ÙØ§Ù„Ù†ÙÙ‘ÙŠÙÙ‘Ø§ØªÙ",fr:"Les actes ne valent que par les intentions.",src:"Bukhari & Muslim",vertu:"L'intention pure transforme tout acte en adoration.",cat:"Fondements"},
  {num:5,ar:"Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…Ù Ù…ÙÙ†Ù’ Ø³ÙÙ„ÙÙ…Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…ÙÙˆÙ†Ù Ù…ÙÙ†Ù’ Ù„ÙØ³ÙØ§Ù†ÙÙ‡Ù ÙˆÙÙŠÙØ¯ÙÙ‡Ù",fr:"Le musulman est celui dont les autres sont Ã  l'abri de sa langue et de sa main.",src:"Bukhari",vertu:"Nuire par la parole ou l'action contredit l'essence de la foi.",cat:"CaractÃ¨re"},
  {num:6,ar:"ØªÙØ³ÙØ­ÙÙ‘Ø±ÙÙˆØ§ ÙÙØ¥ÙÙ†ÙÙ‘ ÙÙÙŠ Ø§Ù„Ø³ÙÙ‘Ø­ÙÙˆØ±Ù Ø¨ÙØ±ÙÙƒÙØ©Ù‹",fr:"Prenez le repas du Suhur, car dans ce repas il y a une bÃ©nÃ©diction.",src:"Bukhari & Muslim",vertu:"MÃªme quelques gorgÃ©es d'eau suffisent pour cette bÃ©nÃ©diction.",cat:"Ramadan"},
  {num:7,ar:"Ù„ÙÙ„ØµÙÙ‘Ø§Ø¦ÙÙ…Ù ÙÙØ±Ù’Ø­ÙØªÙØ§Ù†Ù Ø¹ÙÙ†Ù’Ø¯Ù ÙÙØ·Ù’Ø±ÙÙ‡Ù ÙˆÙØ¹ÙÙ†Ù’Ø¯Ù Ù„ÙÙ‚ÙØ§Ø¡Ù Ø±ÙØ¨ÙÙ‘Ù‡Ù",fr:"Le jeÃ»neur connaÃ®t deux joies : quand il rompt le jeÃ»ne et quand il rencontre son Seigneur.",src:"Bukhari & Muslim",vertu:"La joie de l'Iftar est belle. Mais la joie devant Allah sera infiniment plus grande.",cat:"Ramadan"},
  {num:8,ar:"Ø®ÙÙŠÙ’Ø±ÙÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ ØªÙØ¹ÙÙ„ÙÙ‘Ù…Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙˆÙØ¹ÙÙ„ÙÙ‘Ù…ÙÙ‡Ù",fr:"Le meilleur d'entre vous est celui qui apprend le Coran et l'enseigne.",src:"Bukhari",vertu:"Transmettre le Coran est l'une des meilleures actions.",cat:"Coran"},
];
const DUAS=[
  {cat:"Ramadan",sit:"Rupture du jeÃ»ne (Iftar)",ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø£ÙÙÙ’Ø·ÙØ±Ù’ØªÙ",ph:"Allahoumma laka soumtou wa ala rizqika aftartou",fr:"Ã” Allah, c'est pour Toi que j'ai jeÃ»nÃ© et avec Ta provision que je romps le jeÃ»ne.",src:"Abu Dawud"},
  {cat:"Ramadan",sit:"Vue du croissant de lune",ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ‡ÙÙ„ÙÙ‘Ù‡Ù Ø¹ÙÙ„ÙÙŠÙ’Ù†ÙØ§ Ø¨ÙØ§Ù„Ø£ÙÙ…Ù’Ù†Ù ÙˆÙØ§Ù„Ø¥ÙÙŠÙ…ÙØ§Ù†Ù",ph:"Allahoumma ahillahoo alayna bil-amni wal-eeymaan",fr:"Ã” Allah, fais que ce croissant nous apporte sÃ©curitÃ© et foi.",src:"Tirmidhi"},
  {cat:"Laylat al-Qadr",sit:"La Nuit du Destin",ar:"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø¹ÙÙÙÙˆÙŒÙ‘ ØªÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙÙÙ’ÙˆÙ ÙÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†ÙÙ‘ÙŠ",ph:"Allahoumma innaka afouwoun touhibboul-afwa fafou anni",fr:"Ã” Allah, Tu es Celui qui pardonne et Tu aimes pardonner, alors pardonne-moi.",src:"Tirmidhi"},
  {cat:"Quotidien",sit:"En se rÃ©veillant",ar:"Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø£ÙØ­Ù’ÙŠÙØ§Ù†ÙØ§ Ø¨ÙØ¹Ù’Ø¯Ù Ù…ÙØ§ Ø£ÙÙ…ÙØ§ØªÙÙ†ÙØ§",ph:"Alhamdulillahi alladhi ahyaana bada maa amaatanaa",fr:"Louange Ã  Allah qui nous a fait revivre aprÃ¨s nous avoir fait mourir.",src:"Bukhari"},
  {cat:"Quotidien",sit:"Avant de manger",ar:"Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¨ÙØ±ÙÙƒÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù",ph:"Bismillahi wa ala barakati-llah",fr:"Au nom d'Allah et avec la bÃ©nÃ©diction d'Allah.",src:"Abu Dawud"},
  {cat:"Protection",sit:"Protection contre tout mal",ar:"Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù„Ø§ ÙŠÙØ¶ÙØ±ÙÙ‘ Ù…ÙØ¹Ù Ø§Ø³Ù’Ù…ÙÙ‡Ù Ø´ÙÙŠÙ’Ø¡ÙŒ",ph:"Bismillahi-lladhi laa yadurrou maa ismihi shayoun",fr:"Au nom d'Allah, avec Lequel rien ne peut nuire.",src:"Abu Dawud"},
  {cat:"Dua du soir",sit:"Avant de dormir",ar:"Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ…ÙÙˆØªÙ ÙˆÙØ£ÙØ­Ù’ÙŠÙØ§",ph:"Bismikal-lahoumma amootu wa ahyaa",fr:"En Ton nom, Ã´ Allah, je meurs et je vis.",src:"Bukhari"},
];
const WS_WORDS=['ALLAH','CORAN','RAMADAN','SALAT','ZAKAT','HAJJ','SAWM','SALAM','NOUR','TAWBAH','IMAN','WUDU','DEEN','DUAA','SABR'];
const AYAHS=[
  {ar:"Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø£ÙÙ†Ø²ÙÙ„Ù ÙÙÙŠÙ‡Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù",fr:"Le mois de Ramadan est celui durant lequel le Coran fut rÃ©vÃ©lÃ©.",ref:"Al-Baqara 2:185"},
  {ar:"ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ",fr:"Quand Mes serviteurs t'interrogent sur Moi, alors Je suis proche.",ref:"Al-Baqara 2:186"},
  {ar:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙŠÙ†Ù",fr:"Certes, Allah est avec les endurants.",ref:"Al-Baqara 2:153"},
  {ar:"ÙÙØ¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§",fr:"Car aprÃ¨s la difficultÃ© vient la facilitÃ©.",ref:"Al-Inshirah 94:5"},
  {ar:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙØ¶ÙÙŠØ¹Ù Ø£ÙØ¬Ù’Ø±Ù Ø§Ù„Ù’Ù…ÙØ­Ù’Ø³ÙÙ†ÙÙŠÙ†Ù",fr:"Allah ne laisse pas perdre la rÃ©compense des bienfaisants.",ref:"Hud 11:115"},
];

/* â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â• */
let myName='',spaceCode='',db=null;
let unreadChat=0,inChat=false;
let dhikrIdx=0,dhikrCount=0,dhikrTarget=33;
let quizState=null,quizAnswered=false,quizSessionId=null,quizMulti=false,quizOtherRef=null;
let sprintInterval=null,sprintActive=false,sprintScore=0,sprintTotal=0,sprintQIdx=0,sprintPool=[],sprintT=30;
let memFlipped=[],memMatched=0,memCards=[],memLocked=false,memMoves=0,memTotal=0;
let wsSelected=[],wsFound=[],wsGrid=[],wsWords=[],wsDragging=false,wsStartCell=null;
let stats={nour:0,quizDone:0,hadithRead:0,dhikrTotal:0,wordsFound:0,sprintBest:0,memoryDone:0};
let earnedBadges=new Set();
let chatMsgKeys=new Set();

/* â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â• */
const shuffle=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=0|Math.random()*(i+1);[b[i],b[j]]=[b[j],b[i]];}return b};
const esc=t=>String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const tnow=()=>new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800)}
function closeModal(id){document.getElementById(id).style.display='none'}
function spawnParticle(x,y){
  const p=document.createElement('div');p.className='particle';
  const sz=Math.random()*8+4;
  const clr=Math.random()>.5?'var(--gold)':'var(--teal)';
  p.style.cssText=`width:${sz}px;height:${sz}px;left:${x}px;top:${y}px;background:${clr};opacity:.9;--dur:${.8+Math.random()}s`;
  document.body.appendChild(p);setTimeout(()=>p.remove(),1500);
}
const $=id=>document.getElementById(id);

function linkify(text){
  const urlRe=/https?:\/\/[^\s<>"]+/g;
  return esc(text).replace(urlRe,m=>`<a href="${m}" target="_blank" rel="noopener">${m}</a>`);
}

/* â•â•â•â•â•â•â•â•â•â•â• FIREBASE â•â•â•â•â•â•â•â•â•â•â• */
function initFirebase(){
  try{
    const cfg={apiKey:"AIzaSyDNYqvNg6goVwEn-UJ5ll9ZKFMEqe7W4yA",authDomain:"ramadan-space.firebaseapp.com",databaseURL:"https://ramadan-space-default-rtdb.firebaseio.com",projectId:"ramadan-space"};
    if(!firebase.apps.length)firebase.initializeApp(cfg);
    db=firebase.database();
    db.ref('.info/connected').on('value',snap=>{if(snap.val()&&myName){listenChat();listenMembers();}});
  }catch(e){console.error('Firebase:',e)}
}
function listenChat(){
  if(!db)return;
  db.ref(`spaces/${spaceCode}/chat`).limitToLast(100).on('child_added',snap=>{
    const msg=snap.val();if(msg)appendChatMsg(msg,snap.key);
  });
}
function listenMembers(){
  if(!db)return;
  db.ref(`spaces/${spaceCode}/members/${myName}`).set({name:myName,ts:Date.now()});
  setInterval(()=>db&&db.ref(`spaces/${spaceCode}/members/${myName}`).update({ts:Date.now()}),25000);
  db.ref(`spaces/${spaceCode}/members`).on('value',snap=>{
    const active=Object.values(snap.val()||{}).filter(m=>Date.now()-m.ts<120000);
    renderAvatars(active);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â• QUIZ MULTI (tour par tour) â•â•â•â•â•â•â•â•â•â•â• */
function sendGameInvite(game){
  const inv={from:myName,game,inviteId:'inv_'+Date.now(),ts:Date.now()};
  const msg={from:myName,text:'__INVITE__'+JSON.stringify(inv),time:tnow(),ts:Date.now()};
  if(db)db.ref(`spaces/${spaceCode}/chat`).push(msg);
  else appendChatMsg(msg,'local_'+Date.now());
  toast('Invitation envoyÃ©e !');
}
function acceptInvite(inviteId,fromUser){
  quizSessionId=inviteId;quizMulti=true;
  startQuiz(true,fromUser,'joiner');
  showPanel('quiz');
  toast('Tu rejoins le quiz de '+fromUser+' !');
  if(db)db.ref(`spaces/${spaceCode}/quiz/${inviteId}/joiner`).set(myName);
}
function startQuizAsHost(inviteId,joinerName){
  quizSessionId=inviteId;quizMulti=true;
  startQuiz(true,joinerName,'host');
  showPanel('quiz');
}
function listenQuizMulti(sessionId,role){
  if(!db)return;
  if(quizOtherRef)quizOtherRef.off();
  // Listen for turn state and opponent score
  quizOtherRef=db.ref(`spaces/${spaceCode}/quiz/${sessionId}/state`);
  quizOtherRef.on('value',snap=>{
    const st=snap.val();if(!st)return;
    if(quizState){quizState.otherScore=st.otherScore||0;quizState.currentTurn=st.currentTurn||'host';}
    updateTurnUI();
  });
  if(role==='host'){
    // listen for joiner joining
    db.ref(`spaces/${spaceCode}/quiz/${sessionId}/joiner`).on('value',snap=>{
      if(snap.val()&&quizState){quizState.otherName=snap.val();$('qn2').textContent=snap.val();toast(snap.val()+' a rejoint le quiz !');}
    });
  }
}
function pushQuizTurnState(){
  if(!db||!quizSessionId||!quizState)return;
  db.ref(`spaces/${spaceCode}/quiz/${quizSessionId}/state`).update({
    currentTurn:quizState.currentTurn,
    [`score_${quizState.myRole}`]:quizState.score,
    ts:Date.now()
  });
}
function isMyTurn(){return !quizState.multi||quizState.currentTurn===quizState.myRole}
function updateTurnUI(){
  const tb=$('quiz-turn-bar');if(!tb||!quizState||!quizState.multi){if(tb)tb.style.display='none';return}
  tb.style.display='block';
  if(isMyTurn()){tb.className='turn-bar my-turn';tb.textContent='ğŸŸ¡ C\'est ton tour !'}
  else{tb.className='turn-bar their-turn';tb.textContent='â³ Tour de '+quizState.otherName+'â€¦'}
}

/* â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â• */
function goToRoom(){
  const name=$('ln').value.trim();
  const code=$('lcode').value.trim().toUpperCase().replace(/\s+/g,'');
  if(!name){toast('Entre ton prÃ©nom !');return}
  if(!code){toast('Entre un code d\'espace !');return}
  myName=name;spaceCode=code;
  localStorage.setItem('sk_name',name);localStorage.setItem('sk_code',code);
  loadStats();
  $('login-screen').style.display='none';
  $('app').style.display='flex';
  initApp();
}
function confirmBack(){
  if(confirm('Changer d\'espace ? Tu vas revenir Ã  la connexion.')){
    if(db){db.ref(`spaces/${spaceCode}/members/${myName}`).remove();db.goOffline();}
    $('app').style.display='none';$('login-screen').style.display='flex';
    chatMsgKeys.clear();$('chat-msgs').innerHTML='<div class="msg-sys">Assalamu Alaykoum â€” Bienvenue dans Sakina Space</div>';
  }
}

function initApp(){
  $('home-welcome').textContent='Bienvenue, '+myName+' ğŸŒ™';
  $('lb-code-sub').textContent='Espace : '+spaceCode;
  const a=AYAHS[new Date().getDate()%AYAHS.length];
  $('aw-ar').textContent=a.ar;$('aw-fr').textContent='Â« '+a.fr+' Â»';$('aw-ref').textContent='â€” '+a.ref;
  $('av-wrap').innerHTML=`<div class="av me">${myName.charAt(0).toUpperCase()}</div>`;
  renderHadiths();renderDuas();renderDhikrSelect();
  updateNourUI();updateStatsUI();
  initFirebase();
  if('visualViewport' in window){
    window.visualViewport.addEventListener('resize',handleVP);
    window.visualViewport.addEventListener('scroll',handleVP);
  }
}
function handleVP(){
  const vp=window.visualViewport;
  const off=Math.max(0,window.innerHeight-vp.height-vp.offsetTop);
  document.querySelectorAll('.chat-input-row').forEach(r=>r.style.paddingBottom=(off+10)+'px');
}

function renderAvatars(members){
  const w=$('av-wrap');
  w.innerHTML=`<div class="av me" title="${esc(myName)}">${myName.charAt(0).toUpperCase()}</div>`;
  members.filter(m=>m.name!==myName).slice(0,4).forEach(m=>{
    const d=document.createElement('div');d.className='av other';d.title=m.name;
    d.textContent=(m.name||'?').charAt(0).toUpperCase();w.appendChild(d);
  });
  $('online-count').textContent=members.length;
}

/* â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â• */
function showPanel(id){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  $('panel-'+id).classList.add('active');
  const ni=$('nav-'+id);if(ni)ni.classList.add('active');
  inChat=(id==='chat');
  if(inChat){unreadChat=0;updateChatBadge();}
  if(id==='leaderboard')renderLeaderboard();
}
function updateChatBadge(){
  const b=$('chat-badge');
  if(unreadChat>0){b.style.display='flex';b.textContent=unreadChat}else b.style.display='none';
}

/* â•â•â•â•â•â•â•â•â•â•â• GAMIFICATION â•â•â•â•â•â•â•â•â•â•â• */
function getLevel(n){return LEVELS.slice().reverse().find(l=>n>=l.min)||LEVELS[0]}
function addNour(pts){stats.nour+=pts;saveStats();updateNourUI();checkBadges()}
function updateNourUI(){
  const n=stats.nour,lv=getLevel(n);
  const lvIdx=LEVELS.indexOf(lv);const lvN=LEVELS[lvIdx+1];
  const pct=lvN?Math.min((n-lv.min)/(lvN.min-lv.min)*100,100):100;
  const s=(id,v)=>{const e=$(id);if(e)e.textContent=v};
  s('tb-nour',n);s('tb-level',lv.name);s('home-nour',n);
  s('level-name','Niveau : '+lv.name);s('level-from',lv.min);
  s('level-to',lvN?lvN.min:'MAX');s('level-next-name',lvN?'â†’ '+lvN.name:'');
  const f=$('nour-bar-fill');if(f)f.style.width=pct+'%';
}
function checkBadges(){
  for(const b of BADGES){
    if(!earnedBadges.has(b.id)&&b.cond(stats)){
      earnedBadges.add(b.id);
      $('bm-icon').innerHTML=BSVG[b.svgKey]||'';
      $('bm-name').textContent=b.name;$('bm-desc').textContent=b.req;
      $('badge-modal').style.display='flex';break;
    }
  }
}
function saveStats(){
  localStorage.setItem('sk_stats_'+spaceCode,JSON.stringify(stats));
  if(db)db.ref(`spaces/${spaceCode}/scores/${myName}`).set({name:myName,nour:stats.nour,ts:Date.now()});
}
function loadStats(){
  const s=localStorage.getItem('sk_stats_'+spaceCode);
  if(s)stats={...stats,...JSON.parse(s)};
  earnedBadges=new Set();BADGES.forEach(b=>{if(b.cond(stats))earnedBadges.add(b.id)});
}
function updateStatsUI(){
  const s=(id,v)=>{const e=$(id);if(e)e.textContent=v};
  s('stat-quiz',stats.quizDone);s('stat-hadith',stats.hadithRead);
  s('stat-dhikr',stats.dhikrTotal);s('stat-words',stats.wordsFound);
  const pf=(id,v,mx)=>{const e=$(id);if(e)e.style.width=Math.min(v/mx*100,100)+'%'};
  pf('pf-quiz',stats.quizDone,20);pf('pf-hadith',stats.hadithRead,HADITHS.length);
  pf('pf-dhikr',stats.dhikrTotal,500);pf('pf-words',stats.wordsFound,50);
}

/* â•â•â•â•â•â•â•â•â•â•â• CHAT â•â•â•â•â•â•â•â•â•â•â• */
function sendChat(){
  const inp=$('chat-inp');const text=inp.value.trim();if(!text)return;inp.value='';
  const msg={from:myName,text,time:tnow(),ts:Date.now()};
  if(db)db.ref(`spaces/${spaceCode}/chat`).push(msg);
  else appendChatMsg(msg,'local_'+Date.now());
}
function quickSend(text){
  const msg={from:myName,text,time:tnow(),ts:Date.now()};
  if(db)db.ref(`spaces/${spaceCode}/chat`).push(msg);
  else appendChatMsg(msg,'local_'+Date.now());
}
function sendMedia(e){
  const file=e.target.files[0];if(!file)return;
  const isImg=file.type.startsWith('image/');const isVid=file.type.startsWith('video/');
  if(!isImg&&!isVid){toast('Seulement images et vidÃ©os');return}
  const reader=new FileReader();
  reader.onload=ev=>{
    const msg={from:myName,text:'',mediaType:isImg?'image':'video',mediaData:ev.target.result,time:tnow(),ts:Date.now()};
    if(db)db.ref(`spaces/${spaceCode}/chat`).push(msg);
    else appendChatMsg(msg,'local_'+Date.now());
  };
  reader.readAsDataURL(file);
  e.target.value='';
}
function appendChatMsg(msg,key){
  if(key&&chatMsgKeys.has(key))return;if(key)chatMsgKeys.add(key);
  const c=$('chat-msgs');
  const atBot=c.scrollHeight-c.scrollTop<=c.clientHeight+100;
  const mine=msg.from===myName;
  // Game invite
  if(msg.text&&msg.text.startsWith('__INVITE__')){
    try{
      const inv=JSON.parse(msg.text.replace('__INVITE__',''));
      const w=document.createElement('div');w.className='msg-wrap'+(mine?' mine':'');
      w.innerHTML=`<div class="m-av">${(msg.from||'?').charAt(0).toUpperCase()}</div>
<div style="flex:1"><div class="m-name">${esc(msg.from||'')}</div>
<div class="m-bubble invite-bubble">
<div style="font-size:.74rem;font-weight:700;margin-bottom:4px">ğŸ¯ Invitation au Quiz Islam</div>
<div style="font-size:.76rem;color:var(--muted)">Joue en tour par tour avec ${esc(inv.from)}</div>
${!mine?`<button class="invite-btn" onclick="acceptInvite('${esc(inv.inviteId)}','${esc(inv.from)}');this.disabled=true;this.textContent='Rejoint !'">Rejoindre le quiz</button>`
:'<div style="font-size:.72rem;color:var(--teal);margin-top:6px;font-weight:600">Invitation envoyÃ©e âœ“</div>'}
</div>
<div class="m-time">${msg.time||''}</div></div>`;
      c.appendChild(w);
      if(!inChat&&!mine){unreadChat++;updateChatBadge()}
      if(atBot)c.scrollTop=c.scrollHeight;
      // If I'm the host and someone joined
      if(mine&&db){
        db.ref(`spaces/${spaceCode}/quiz/${inv.inviteId}/joiner`).on('value',snap=>{
          if(snap.val()&&snap.val()!==myName&&!quizState){
            startQuizAsHost(inv.inviteId,snap.val());
          }
        });
      }
    }catch(e){}
    return;
  }
  const w=document.createElement('div');w.className='msg-wrap'+(mine?' mine':'');
  let bubbleInner='';
  if(msg.mediaType==='image'&&msg.mediaData){
    bubbleInner=`${msg.text?linkify(msg.text)+'<br>':''}<img class="chat-img" src="${msg.mediaData}" onclick="openLightbox('${msg.mediaData}')">`;
  }else if(msg.mediaType==='video'&&msg.mediaData){
    bubbleInner=`${msg.text?linkify(msg.text)+'<br>':''}<video class="chat-vid" src="${msg.mediaData}" controls playsinline></video>`;
  }else{
    bubbleInner=linkify(msg.text||'');
  }
  w.innerHTML=`<div class="m-av">${(msg.from||'?').charAt(0).toUpperCase()}</div>
<div><div class="m-name">${esc(msg.from||'')}</div>
<div class="m-bubble">${bubbleInner}</div>
<div class="m-time">${msg.time||''}</div></div>`;
  c.appendChild(w);
  if(!inChat&&!mine){unreadChat++;updateChatBadge()}
  if(atBot)c.scrollTop=c.scrollHeight;
}
function openLightbox(src){$('lb-img').src=src;$('lightbox').style.display='flex'}

/* â•â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â•â• */
function startQuiz(multi=false,otherName='',myRole='host'){
  const pool=shuffle([...QUIZ_DATA]);
  quizState={pool,cur:0,score:0,total:20,multi,otherName,otherScore:0,myRole,currentTurn:'host'};
  quizAnswered=false;
  if(multi){
    $('qn2').textContent=otherName||'Adversaire';
    listenQuizMulti(quizSessionId,myRole);
    if(myRole==='host')db&&db.ref(`spaces/${spaceCode}/quiz/${quizSessionId}/state`).set({currentTurn:'host',score_host:0,score_joiner:0,ts:Date.now()});
  }else{$('qn2').textContent='â€”';$('qs2').textContent='â€”'}
  $('qn1').textContent=myName;$('qs1').textContent='0';
  $('quiz-header').style.display='block';
  $('qpf').style.width='0%';
  updateTurnUI();
  renderQuizQ();
}
function renderQuizQ(){
  const s=quizState;if(!s)return;
  if(s.cur>=s.total){renderQuizResult();return}
  if(s.multi&&!isMyTurn()){
    $('quiz-body').innerHTML=`<div style="text-align:center;padding:40px 20px">
<div class="wait-spinner" style="margin:0 auto 16px"></div>
<div style="font-weight:600;color:var(--muted)">En attente du tour de ${esc(s.otherName)}â€¦</div>
</div>`;
    return;
  }
  const q=s.pool[s.cur];const letters=['A','B','C','D'];const si=shuffle([0,1,2,3]);
  let h=`<div class="q-card">
<div style="margin-bottom:8px;display:flex;gap:6px;align-items:center"><span class="tag ${q.cat==='Ramadan'||q.cat==='Coran'?'gold':'teal'}">${q.cat}</span><span style="font-size:.65rem;font-weight:600;color:var(--muted)">Q${s.cur+1}/${s.total}</span></div>
<div class="q-text">${esc(q.q)}</div></div>
<div class="q-answers">`;
  si.forEach((orig,i)=>{
    h+=`<button class="q-ans" onclick="answerQ(this,${orig},${q.c})" data-orig="${orig}"><span class="q-lbl">${letters[i]}</span>${esc(q.a[orig])}</button>`;
  });
  h+=`</div>`;
  $('quiz-body').innerHTML=h;quizAnswered=false;
}
function answerQ(btn,orig,correct){
  if(quizAnswered)return;quizAnswered=true;
  const ok=orig===correct;
  document.querySelectorAll('.q-ans').forEach(b=>{
    b.disabled=true;
    const o=parseInt(b.getAttribute('data-orig'));
    if(o===correct)b.classList.add(b===btn?'correct':'reveal');
    else if(b===btn)b.classList.add('wrong');
  });
  if(ok){
    quizState.score++;
    addNour(50);
    const el=$('qs1');el.textContent=quizState.score;el.classList.add('sf');setTimeout(()=>el.classList.remove('sf'),400);
    const r=btn.getBoundingClientRect();
    for(let i=0;i<6;i++)setTimeout(()=>spawnParticle(r.left+r.width/2+Math.random()*30-15,r.top+10),i*60);
  }
  if(quizState.multi){
    // Switch turn
    quizState.currentTurn=quizState.myRole==='host'?'joiner':'host';
    pushQuizTurnState();
  }
  const q=quizState.pool[quizState.cur];
  $('quiz-body').insertAdjacentHTML('beforeend',
    `<div class="q-expl show">ğŸ’¡ ${esc(q.expl)}</div><button class="q-next show" onclick="nextQ()">Suivant â†’</button>`);
}
function nextQ(){
  quizState.cur++;updateTurnUI();
  if(quizState.cur>=quizState.total){renderQuizResult();return}
  renderQuizQ();
}
function renderQuizResult(){
  stats.quizDone++;saveStats();updateStatsUI();checkBadges();
  $('quiz-header').style.display='none';$('quiz-turn-bar').style.display='none';
  const score=quizState.score;const total=quizState.total;
  const msg=score>=16?'Mashallah, excellent ! ğŸŒŸ':score>=12?'TrÃ¨s bien ! ğŸ‘':score>=8?'Pas mal ! ğŸ’ª':'Continue Ã  apprendre ğŸ“–';
  $('quiz-body').innerHTML=`<div style="text-align:center;padding:24px 16px">
<div style="font-size:3rem;margin-bottom:8px">ğŸ¯</div>
<div style="font-size:1.8rem;font-weight:800;color:var(--text)">${score} / ${total}</div>
<div style="font-size:.82rem;color:var(--muted);margin:6px 0 20px;font-weight:500">${msg} Â· +${score*50} Nour</div>
<button class="btn-gold" style="max-width:220px;margin:0 auto 10px" onclick="startQuiz(false)">Rejouer en solo</button>
<button class="btn-teal" style="max-width:220px;margin:0 auto" onclick="sendGameInvite('quiz');showPanel('chat')">Inviter quelqu'un</button>
</div>`;
  if(quizOtherRef){quizOtherRef.off();quizOtherRef=null}
  quizState=null;quizMulti=false;
}

/* â•â•â•â•â•â•â•â•â•â•â• SPRINT â•â•â•â•â•â•â•â•â•â•â• */
function startSprint(){
  if(sprintInterval)clearInterval(sprintInterval);
  sprintScore=0;sprintTotal=0;sprintQIdx=0;sprintActive=true;sprintT=30;
  sprintPool=shuffle([...QUIZ_DATA]);renderSprintQ();
  sprintInterval=setInterval(()=>{
    sprintT--;
    const tn=$('timer-num'),tc=$('timer-circle');
    if(tn)tn.textContent=sprintT;
    if(tc)tc.style.strokeDashoffset=213.6*(1-sprintT/30);
    if(tn)tn.style.color=sprintT<=5?'var(--rose2)':'var(--text2)';
    if(sprintT<=0){clearInterval(sprintInterval);sprintActive=false;endSprint()}
  },1000);
}
function renderSprintQ(){
  if(!sprintActive)return;
  if(sprintQIdx>=sprintPool.length)sprintPool=shuffle([...QUIZ_DATA]);
  const q=sprintPool[sprintQIdx];const si=shuffle([0,1,2,3]);const letters=['A','B','C','D'];
  $('sprint-wrap').innerHTML=`<div class="sprint-score-bar">
<span style="font-size:.7rem;font-weight:600;color:var(--muted)">Score</span>
<span style="font-size:1.5rem;font-weight:800">${sprintScore}</span>
<span style="font-size:.7rem;font-weight:600;color:var(--muted)">Q${sprintTotal+1}</span></div>
<div class="timer-ring-wrap">
<svg width="80" height="80" viewBox="0 0 80 80">
<circle cx="40" cy="40" r="34" fill="none" stroke="var(--bg3)" stroke-width="5"/>
<circle id="timer-circle" cx="40" cy="40" r="34" fill="none" stroke="${sprintT<=5?'var(--rose)':'var(--teal)'}" stroke-width="5" stroke-linecap="round" stroke-dasharray="213.6" stroke-dashoffset="${213.6*(1-sprintT/30)}" style="transition:stroke-dashoffset .9s linear;transform:rotate(-90deg);transform-origin:40px 40px"/>
</svg>
<div id="timer-num" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:800;color:${sprintT<=5?'var(--rose2)':'var(--text)'}">${sprintT}</div>
</div>
<div class="sprint-q">${esc(q.q)}</div>
<div class="sprint-opts">${si.map((orig,i)=>`<button class="sprint-opt" onclick="answerSprint(this,${orig},${q.c})">${letters[i]}. ${esc(q.a[orig])}</button>`).join('')}</div>`;
}
function answerSprint(btn,orig,correct){
  if(!sprintActive)return;
  document.querySelectorAll('.sprint-opt').forEach(b=>b.disabled=true);
  if(orig===correct){btn.classList.add('correct');sprintScore++;spawnParticle(btn.getBoundingClientRect().left+50,btn.getBoundingClientRect().top)}
  else btn.classList.add('wrong');
  sprintTotal++;sprintQIdx++;
  setTimeout(()=>{if(sprintActive)renderSprintQ()},500);
}
function endSprint(){
  if(sprintScore>stats.sprintBest)stats.sprintBest=sprintScore;
  addNour(sprintScore*10);saveStats();checkBadges();updateStatsUI();
  $('sprint-wrap').innerHTML=`<div class="start-screen">
<div style="font-size:3rem;margin-bottom:8px">âš¡</div>
<div class="start-title">Sprint terminÃ© !</div>
<div class="start-desc">Score : <strong style="font-size:1.3rem">${sprintScore}</strong> / ${sprintTotal}<br>+${sprintScore*10} Nour gagnÃ©<br><span style="color:var(--gold2);font-weight:700">Record : ${stats.sprintBest}</span></div>
<button class="btn-ghost" style="max-width:200px;margin:0 auto" onclick="startSprint()">Rejouer</button></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â• MEMORY â•â•â•â•â•â•â•â•â•â•â• */
function startMemory(){
  memMatched=0;memMoves=0;memFlipped=[];memLocked=false;
  const pool=shuffle(DHIKR_MEMORY).slice(0,6);
  memTotal=pool.length;
  let cards=[];
  pool.forEach((d,i)=>{
    cards.push({id:'a'+i,pairId:i,type:'ar',ar:d.ar,ph:d.ph,fr:d.fr,matched:false,flipped:false});
    cards.push({id:'b'+i,pairId:i,type:'fr',ar:d.ar,ph:d.ph,fr:d.fr,matched:false,flipped:false});
  });
  memCards=shuffle(cards);renderMemory();
}
function renderMemory(){
  let h=`<div class="panel-title" style="margin-bottom:4px">Memory Dhikr</div>
<div class="panel-sub">Associe le dhikr arabe â†” sa traduction franÃ§aise</div>
<div class="mem-stats">
<div class="mem-stat"><div class="mem-stat-val" id="mem-pairs">${memMatched}/${memTotal}</div><div class="mem-stat-lbl">Paires</div></div>
<div class="mem-stat"><div class="mem-stat-val" id="mem-moves">${memMoves}</div><div class="mem-stat-lbl">Coups</div></div>
</div><div class="memory-grid" id="mem-grid">`;
  memCards.forEach((c,i)=>{
    const isAr=c.type==='ar';
    h+=`<div class="mem-card${c.flipped?' flipped':''}${c.matched?' matched':''}" id="mc-${c.id}" data-type="${c.type}" onclick="flipMem(${i})">
<div class="mem-face-back">
<svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--border2)" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
<div style="font-size:.5rem;font-weight:700;color:var(--muted2);margin-top:3px;text-transform:uppercase;letter-spacing:1px">${isAr?'Arabe':'Traduction'}</div>
</div>
<div class="mem-face-front">
${isAr
  ? `<div class="mem-ar">${c.ar}</div><div class="mem-ph">${c.ph}</div><div class="mem-type">Dhikr</div>`
  : `<div class="mem-fr">${c.fr}</div><div class="mem-ph">${c.ph}</div><div class="mem-type">Traduction</div>`}
</div></div>`;
  });
  h+=`</div>`;
  $('memory-wrap').innerHTML=h;
}
function flipMem(i){
  if(memLocked)return;
  const c=memCards[i];if(c.flipped||c.matched)return;
  c.flipped=true;const el=$('mc-'+c.id);if(el)el.classList.add('flipped');
  memFlipped.push(i);
  if(memFlipped.length===2){
    memMoves++;memLocked=true;
    const [a,b]=memFlipped;
    if(memCards[a].pairId===memCards[b].pairId&&memCards[a].type!==memCards[b].type){
      memCards[a].matched=true;memCards[b].matched=true;
      const ea=$('mc-'+memCards[a].id),eb=$('mc-'+memCards[b].id);
      if(ea)ea.classList.add('matched');if(eb)eb.classList.add('matched');
      memMatched++;
      const pm=$('mem-pairs');if(pm)pm.textContent=memMatched+'/'+memTotal;
      const mm=$('mem-moves');if(mm)mm.textContent=memMoves;
      spawnParticle(window.innerWidth/2,window.innerHeight/3);
      addNour(15);toast(memCards[a].ph+' â€” '+memCards[a].fr);
      memFlipped=[];memLocked=false;
      if(memMatched===memTotal){
        stats.memoryDone++;saveStats();updateStatsUI();checkBadges();
        setTimeout(()=>{
          $('memory-wrap').insertAdjacentHTML('beforeend',`
<div class="card" style="text-align:center;margin-top:10px;border-color:rgba(14,122,110,.3)">
<div style="font-size:2.5rem;margin-bottom:8px">ğŸ‰</div>
<div style="font-size:1.1rem;font-weight:800;margin:4px 0">Memory complÃ©tÃ© !</div>
<div style="font-size:.78rem;color:var(--muted);margin-bottom:12px">${memMoves} coups Â· +${memTotal*15} Nour</div>
<button class="btn-teal" onclick="startMemory()">Rejouer</button></div>`);
        },400);
      }
    }else{
      setTimeout(()=>{
        memCards[a].flipped=false;memCards[b].flipped=false;
        const ea=$('mc-'+memCards[a].id),eb=$('mc-'+memCards[b].id);
        if(ea)ea.classList.remove('flipped');if(eb)eb.classList.remove('flipped');
        memFlipped=[];memLocked=false;
        const mm=$('mem-moves');if(mm)mm.textContent=memMoves;
      },900);
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â• WORD SEARCH â•â•â•â•â•â•â•â•â•â•â• */
function startWS(){
  wsFound=[];wsSelected=[];wsWords=shuffle(WS_WORDS).slice(0,7);
  const sz=10,grid=Array.from({length:sz},()=>Array(sz).fill(''));
  const dirs=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];
  wsWords.forEach(word=>{
    let placed=false,tries=0;
    while(!placed&&tries<300){tries++;
      const [dr,dc]=dirs[0|Math.random()*dirs.length];
      const r=0|Math.random()*sz,c=0|Math.random()*sz;let ok=true;
      for(let i=0;i<word.length;i++){const nr=r+dr*i,nc=c+dc*i;if(nr<0||nr>=sz||nc<0||nc>=sz||grid[nr][nc]&&grid[nr][nc]!==word[i]){ok=false;break}}
      if(ok){for(let i=0;i<word.length;i++)grid[r+dr*i][c+dc*i]=word[i];placed=true}
    }
  });
  const alpha='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  for(let r=0;r<sz;r++)for(let c=0;c<sz;c++)if(!grid[r][c])grid[r][c]=alpha[0|Math.random()*26];
  wsGrid=grid;renderWS();
}
function renderWS(){
  const sz=10;
  let h=`<div class="panel-title" style="margin-bottom:8px">Mots mÃªlÃ©s</div>
<div class="ws-words" id="ws-words-list">`;
  wsWords.forEach(w=>{h+=`<div class="ws-word${wsFound.includes(w)?' found':''}" id="ww-${w}">${w}</div>`});
  h+=`</div><div class="ws-grid" id="ws-grid">`;
  for(let r=0;r<sz;r++)for(let c=0;c<sz;c++){
    const idx=r*sz+c;
    h+=`<div class="ws-cell" id="wsc-${idx}" onmousedown="wsDown(${idx})" onmouseover="wsOver(${idx})" onmouseup="wsUp()" ontouchstart="event.preventDefault();wsDown(${idx})" ontouchmove="wsTM(event)" ontouchend="wsUp()">${wsGrid[r][c]}</div>`;
  }
  h+=`</div><div style="text-align:center;margin-top:8px"><button class="btn-sm" onclick="startWS()">Nouvelle grille</button></div>`;
  $('ws-wrap').innerHTML=h;
}
function wsDown(idx){wsDragging=true;wsStartCell=idx;wsSelected=[idx];refreshWSCells()}
function wsOver(idx){
  if(!wsDragging||wsStartCell===null)return;
  const sz=10,sr=0|wsStartCell/sz,sc=wsStartCell%sz,er=0|idx/sz,ec=idx%sz;
  const dr=er-sr,dc=ec-sc,len=Math.max(Math.abs(dr),Math.abs(dc));
  if(len===0){wsSelected=[wsStartCell];refreshWSCells();return}
  if(Math.abs(dr)!==Math.abs(dc)&&dr!==0&&dc!==0)return;
  const stepR=dr===0?0:dr/Math.abs(dr),stepC=dc===0?0:dc/Math.abs(dc);
  wsSelected=[];for(let i=0;i<=len;i++)wsSelected.push((sr+stepR*i)*sz+(sc+stepC*i));
  refreshWSCells();
}
function wsTM(e){const el=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);if(el?.id?.startsWith('wsc-'))wsOver(parseInt(el.id.replace('wsc-','')))}
function wsUp(){wsDragging=false;checkWSWord()}
function refreshWSCells(){document.querySelectorAll('.ws-cell').forEach((el,i)=>el.classList.toggle('selected',wsSelected.includes(i)))}
function checkWSWord(){
  const sz=10,letters=wsSelected.map(i=>wsGrid[0|i/sz][i%sz]).join('');
  const rev=letters.split('').reverse().join('');
  const match=wsWords.find(w=>w===letters||w===rev);
  if(match&&!wsFound.includes(match)){
    wsFound.push(match);
    const ww=$('ww-'+match);if(ww)ww.classList.add('found');
    wsSelected.forEach(i=>{const el=$('wsc-'+i);if(el)el.classList.add('found-cell')});
    stats.wordsFound++;saveStats();addNour(35);updateStatsUI();checkBadges();
    for(let i=0;i<6;i++)setTimeout(()=>spawnParticle(window.innerWidth/2+Math.random()*80-40,window.innerHeight/2),i*70);
    toast(match+' trouvÃ© ! +35 Nour');
    if(wsFound.length===wsWords.length){
      setTimeout(()=>{
        $('ws-wrap').insertAdjacentHTML('beforeend',`<div class="card" style="text-align:center;margin-top:10px;border-color:rgba(109,61,204,.3)">
<div style="font-size:2.5rem;margin-bottom:8px">ğŸ”</div>
<div style="font-size:1.1rem;font-weight:800;margin:4px 0;color:var(--purple2)">Tous les mots trouvÃ©s !</div>
<div style="font-size:.78rem;color:var(--muted);margin-bottom:12px">+${wsWords.length*35} Nour</div>
<button class="btn-ghost" style="border-color:var(--purple);color:var(--purple2);max-width:200px;margin:0 auto" onclick="startWS()">Nouvelle grille</button></div>`);
      },400);
    }
  }
  wsSelected=[];refreshWSCells();
}

/* â•â•â•â•â•â•â•â•â•â•â• HADITHS â•â•â•â•â•â•â•â•â•â•â• */
function renderHadiths(){
  const liked=JSON.parse(localStorage.getItem('sk_liked_'+spaceCode)||'[]');
  const seen=JSON.parse(localStorage.getItem('sk_seen_'+spaceCode)||'[]');
  const list=$('hadith-list');if(!list)return;list.innerHTML='';
  HADITHS.forEach((h,i)=>{
    const isLiked=liked.includes(i);
    const d=document.createElement('div');d.className='h-card';
    d.innerHTML=`<div class="h-num">Hadith ${h.num} Â· <span class="tag ${h.cat==='Ramadan'||h.cat==='Coran'?'gold':'teal'}">${h.cat}</span></div>
<div class="h-ar">${h.ar}</div><div class="h-fr">"${h.fr}"</div><div class="h-src">â€” ${h.src}</div>
<div class="h-reveal"><p class="h-vertu">${h.vertu}</p></div>
<div class="h-actions" onclick="event.stopPropagation()">
<button class="action-btn${isLiked?' liked':''}" onclick="toggleLike(${i})">
<svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="${isLiked?'currentColor':'none'}" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>${isLiked?'AimÃ©':'Aimer'}</button>
<button class="action-btn" onclick="shareHadith(${i})">
<svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Partager</button>
</div>`;
    d.addEventListener('click',()=>{
      d.classList.toggle('open');
      if(!seen.includes(i)){seen.push(i);localStorage.setItem('sk_seen_'+spaceCode,JSON.stringify(seen));stats.hadithRead=seen.length;addNour(5);saveStats();updateStatsUI();checkBadges()}
    });
    list.appendChild(d);
  });
}
function toggleLike(i){
  const liked=JSON.parse(localStorage.getItem('sk_liked_'+spaceCode)||'[]');
  const idx=liked.indexOf(i);if(idx>=0)liked.splice(idx,1);else liked.push(i);
  localStorage.setItem('sk_liked_'+spaceCode,JSON.stringify(liked));renderHadiths();
}
function shareHadith(i){
  const h=HADITHS[i];
  const msg={from:myName,text:'"'+h.fr+'" â€” '+h.src,time:tnow(),ts:Date.now()};
  if(db)db.ref(`spaces/${spaceCode}/chat`).push(msg);else appendChatMsg(msg,'local_'+Date.now());
  showPanel('chat');toast('Hadith partagÃ© au chat');
}

/* â•â•â•â•â•â•â•â•â•â•â• DUAS â•â•â•â•â•â•â•â•â•â•â• */
let activeDuaCat='Tous';
function renderDuas(){
  const cats=['Tous',...new Set(DUAS.map(d=>d.cat))];
  const ce=$('dua-cats');if(!ce)return;ce.innerHTML='';
  cats.forEach(c=>{const b=document.createElement('div');b.className='dua-cat'+(c===activeDuaCat?' active':'');b.textContent=c;b.onclick=()=>{activeDuaCat=c;renderDuas()};ce.appendChild(b)});
  const dl=$('dua-list');if(!dl)return;dl.innerHTML='';
  DUAS.filter(d=>activeDuaCat==='Tous'||d.cat===activeDuaCat).forEach(d=>{
    const el=document.createElement('div');el.className='dua-card';
    el.innerHTML=`<div class="dua-sit">${d.sit}</div><div class="dua-ar">${d.ar}</div><div class="dua-ph">${d.ph}</div><div class="dua-fr">${d.fr}</div><div class="dua-src">â€” ${d.src}</div>`;
    dl.appendChild(el);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â• DHIKR â•â•â•â•â•â•â•â•â•â•â• */
function setTarget(t,btn){
  dhikrTarget=t;dhikrCount=Math.min(dhikrCount,t);
  document.querySelectorAll('.dhikr-target-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  DHIKR_LIST[dhikrIdx].target=t;updateDhikrUI();
}
function renderDhikrSelect(){
  const el=$('dhikr-select');if(!el)return;el.innerHTML='';
  DHIKR_LIST.forEach((d,i)=>{
    const b=document.createElement('div');b.className='dhikr-opt'+(i===dhikrIdx?' active':'');
    b.innerHTML=`<span class="do-ar">${d.ar}</span><span class="do-fr">${d.ph}</span>`;
    b.onclick=()=>{dhikrIdx=i;dhikrCount=0;renderDhikrSelect();updateDhikrUI()};
    el.appendChild(b);
  });updateDhikrUI();
}
function updateDhikrUI(){
  const d=DHIKR_LIST[dhikrIdx];const t=dhikrTarget||d.target;
  const s=(id,v)=>{const e=$(id);if(e)e.textContent=v};
  s('dhikr-ar',d.ar);s('dhikr-ph-txt',d.ph);s('dhikr-fr-txt',d.fr);
  s('dhikr-count',dhikrCount);s('dhikr-target',dhikrCount+' / '+t);
  const ring=$('dhikr-ring');if(ring)ring.style.strokeDashoffset=301.6*(1-Math.min(dhikrCount/t,1));
}
function tapDhikr(){
  const d=DHIKR_LIST[dhikrIdx];const t=dhikrTarget||d.target;
  if(dhikrCount>=t){toast(d.ph+' â€” complÃ©tÃ© !');return}
  dhikrCount++;stats.dhikrTotal++;updateDhikrUI();
  spawnParticle(window.innerWidth/2+Math.random()*40-20,window.innerHeight/2);
  if(dhikrCount===t){toast('Mashallah ! '+t+'Ã— â€” '+d.fr);addNour(20)}
  if(stats.dhikrTotal%50===0)addNour(10);
  saveStats();updateStatsUI();checkBadges();
}
function undoDhikr(){if(dhikrCount>0){dhikrCount--;if(stats.dhikrTotal>0)stats.dhikrTotal--;updateDhikrUI()}}
function resetDhikr(){dhikrCount=0;updateDhikrUI()}

/* â•â•â•â•â•â•â•â•â•â•â• LEADERBOARD â•â•â•â•â•â•â•â•â•â•â• */
function renderLeaderboard(){
  const lb=$('lb-list');if(!lb)return;
  lb.innerHTML=`<div style="color:var(--muted);font-size:.8rem;text-align:center;padding:10px">Chargementâ€¦</div>`;
  let players=[{name:myName,nour:stats.nour,isMe:true}];
  if(db){
    db.ref(`spaces/${spaceCode}/scores`).once('value',snap=>{
      const sc=snap.val()||{};
      players=Object.values(sc).map(s=>({name:s.name,nour:s.nour||0,isMe:s.name===myName}));
      if(!players.find(p=>p.isMe))players.push({name:myName,nour:stats.nour,isMe:true});
      renderLBList(players);
    });
  }else renderLBList(players);
  const bg=$('badges-grid');if(!bg)return;bg.innerHTML='';
  BADGES.forEach(b=>{
    const u=earnedBadges.has(b.id);const d=document.createElement('div');d.className='badge-card '+(u?'unlocked':'locked');
    d.innerHTML=`<div class="bc-icon">${BSVG[b.svgKey]||''}</div><div class="bc-name">${b.name}</div><div class="bc-req">${b.req}</div>`;
    bg.appendChild(d);
  });
}
function renderLBList(players){
  const lb=$('lb-list');if(!lb)return;
  players.sort((a,b)=>b.nour-a.nour);lb.innerHTML='';
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  players.forEach((p,i)=>{
    const lv=getLevel(p.nour);
    const d=document.createElement('div');d.className='lb-card'+(p.isMe?' me':'');
    const avBg=p.isMe?'var(--gold-light)':'var(--teal-light)';
    const avBorder=p.isMe?'var(--gold)':'var(--teal)';
    const avColor=p.isMe?'var(--gold2)':'var(--teal)';
    d.innerHTML=`<div class="lb-rank">${medals[i]||`<span style="font-size:.82rem;font-weight:700;color:var(--muted)">#${i+1}</span>`}</div>
<div class="lb-av" style="background:${avBg};border-color:${avBorder};color:${avColor}">${(p.name||'?').charAt(0).toUpperCase()}</div>
<div class="lb-info"><div class="lb-name">${esc(p.name||'?')}${p.isMe?' <span style="font-size:.62rem;color:var(--muted);font-weight:500">(moi)</span>':''}</div><div class="lb-pts">${lv.name}</div></div>
<div style="text-align:right"><div class="lb-nour">${p.nour}</div><div class="lb-nour-lbl">Nour</div></div>`;
    lb.appendChild(d);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â• BOOT â•â•â•â•â•â•â•â•â•â•â• */
window.onload=()=>{
  const name=localStorage.getItem('sk_name');const code=localStorage.getItem('sk_code');
  if(name)$('ln').value=name;if(code)$('lcode').value=code;
};
</script>

</body>
</html>
